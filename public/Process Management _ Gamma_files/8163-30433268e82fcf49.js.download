"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8163],{21755:function(t,e,n){n.d(e,{n:function(){return s}});var o=n(62564),r=n(2784),a=n(37914),i=n(98875),s=function(t){var e=(0,i.ye)("debugLogging");(0,r.useEffect)(function(){if(t){if(e){console.debug("[Prosemirror DevTools] Activating prosemirror-dev-tools");try{(0,o.h)(t.view)}catch(t){}}else(0,o.P)();return a.v.DEBUG_ENABLED&&(window.openPMDT=function(){return(0,o.h)(t.view)}),function(){(0,o.P)(),delete window.openPMDT}}},[t,e])}},19700:function(t,e,n){n.d(e,{c:function(){return c}});var o=n(58125),r=n(2784),a=n(65185),i=n(46358),s=n(62141),c=function(t){var e=(0,r.useState)(function(){return(0,o.xC)({reducer:i.Ct})})[0];return(0,r.useEffect)(function(){null!=t&&t.cards&&e.dispatch((0,a.eJ)({cards:t.cards})),null!=t&&t.doc&&e.dispatch((0,s.pl)({doc:t.doc}))},[t,e]),e}},87880:function(t,e,n){n.d(e,{f:function(){return p}});var o=n(95235),r=n(82269),a=n(23769),i=n(43997),s=n(19700),c=n(82477),u=n(52322),l=["reduxData"];function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach(function(e){(0,o.Z)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var p=function(t){var e=(0,a.Z)({},t),n=e.reduxData,o=(0,r.Z)(e,l),d=(0,s.c)(n);return(0,u.jsx)(i.zt,{store:d,children:(0,u.jsx)(c.y,f(f({},o),{},{readOnly:!0,isStatic:!0,animationsEnabled:!1}))})}},95876:function(t,e,n){n.d(e,{R$:function(){return r},VK:function(){return s},j4:function(){return a},vL:function(){return i}});var o=n(53026),r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{docFlags:{}};return{type:"doc",content:[{type:"document",attrs:e,content:[{type:"card",content:[{type:"title",attrs:{level:o.Y.DocTitle}},{type:"contributors"}]},{type:"card",content:[{type:"heading"}]}]}]}},a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{docFlags:{cardLayoutsEnabled:!0}};return{type:"doc",content:[{type:"document",attrs:t,content:[{type:"card",content:[{type:"title",attrs:{level:o.Y.DocTitle}}]}]}]}},i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{docFlags:{cardLayoutsEnabled:!0}},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{type:"doc",content:[{type:"document",attrs:t,content:e}]}},s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{docFlags:{}};return{type:"doc",content:[{type:"document",attrs:e,content:[{type:"card",content:[{type:"title",attrs:{level:o.Y.DocTitle}},{type:"contributors"}]},{type:"card",attrs:{previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"blank"},content:[{type:"heading",attrs:{horizontalAlign:null,level:2},content:[{type:"text",text:"Quick Start Checklist"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"zap",native:"⚡"}},{type:"text",text:"️ "},{type:"text",marks:[{type:"bold"}],text:"Type "},{type:"text",marks:[{type:"code"}],text:"/"},{type:"text",marks:[{type:"bold"}],text:" in a card to open the slash menu"}]},{type:"bullet",attrs:{indent:1,fontSize:null},content:[{type:"text",text:"It lets you browse and add content blocks quickly"}]},{type:"bullet",attrs:{indent:1,fontSize:null},content:[{type:"text",text:"Content blocks can be added from the "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"7jZEg"}}],text:"insert menu"},{type:"footnote",attrs:{noteId:"7jZEg"},content:[{type:"image",attrs:{id:"Y3FmX",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/b98e59519a994c7abd900f44683bbb5d/optimized/insert-menu-explainer.gif",tempUrl:"blob:https://gamma.app/983566b4-f21e-4d28-bc69-d448c1976833",uploadStatus:0,meta:{width:700,height:459,date_file_modified:"2023/01/20 23:08:42 GMT",duration:4.42,aspect_ratio:1.525,has_clipping_path:!1,frame_count:36,colorspace:"RGB",average_color:"#f7f5f5"},providerMeta:null,name:"insert-menu-explainer.gif",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]},{type:"text",text:" if you prefer to drag"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"heavy_plus_sign",native:"➕"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Add a new card"},{type:"text",text:" (type "},{type:"text",marks:[{type:"code"}],text:"/card"},{type:"text",text:") or select a template via the "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"xLt8J"}}],text:"plus button"},{type:"footnote",attrs:{noteId:"xLt8J"},content:[{type:"image",attrs:{id:"3CSXR",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/a8d6b7149f75401ebd54e6b022670a3e/optimized/image.png",tempUrl:"blob:https://gamma.app/5368f25a-cf30-4410-bf62-bd26080b01f5",uploadStatus:0,meta:{width:844,height:608,date_file_modified:"2023/01/20 21:38:09 GMT",aspect_ratio:1.388,has_clipping_path:!1,frame_count:1,colorspace:"RGB",average_color:"#f7f5f5"},providerMeta:null,name:"image.png",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"newspaper",native:"\uD83D\uDCF0"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Create multi-column layouts"},{type:"text",text:" (type "},{type:"text",marks:[{type:"code"}],text:"/columns"},{type:"text",text:") or "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"JyryA"}}],text:"drag blocks"},{type:"footnote",attrs:{noteId:"JyryA"},content:[{type:"image",attrs:{id:"iJXTh",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/3e47c137ba5d4d13bdafda584b3a8f94/optimized/drag-columns-optimized.gif",tempUrl:"blob:https://gamma.app/654cd2e0-6972-4a24-a7c0-25eff0cf9050",uploadStatus:0,meta:{width:500,height:313,date_file_modified:"2023/01/20 21:35:04 GMT",duration:9.83,aspect_ratio:1.597,has_clipping_path:!1,frame_count:62,colorspace:"RGB",average_color:"#e8cac5"},providerMeta:null,name:"drag-columns-optimized.gif",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]},{type:"text",text:" side by side"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"bridge_at_night",native:"\uD83C\uDF09"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Add an image "},{type:"text",text:"(type "},{type:"text",marks:[{type:"code"}],text:"/image"},{type:"text",text:"). You can drag in or paste image files too!"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"art",native:"\uD83C\uDFA8"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Change the deck "},{type:"text",marks:[{type:"bold"},{type:"footnoteLabel",attrs:{noteId:"mTOBc"}}],text:"theme"},{type:"footnote",attrs:{noteId:"mTOBc"},content:[{type:"paragraph",attrs:{horizontalAlign:null,fontSize:null},content:[{type:"text",text:"Click the "},{type:"text",marks:[{type:"code"}],text:"Theme"},{type:"text",text:" button in the top toolbar, then try clicking some of the different options"}]},{type:"image",attrs:{id:"GHNdu",horizontalAlign:"center",src:"https://cdn.gamma.app/zc87vhr30n8uf3n/db839cee72b7497b9ff1424987641ed5/optimized/image.png",tempUrl:null,uploadStatus:0,meta:{width:806,height:1678,date_file_modified:"2022/08/01 23:13:09 GMT",aspect_ratio:.48,has_clipping_path:!1,frame_count:1,colorspace:"RGB",average_color:"#ccc7ca"},providerMeta:null,name:"image.png",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:"inset",clipPath:["17.31441903150651%","0%","41.5572854690296%","0%"],clipAspectRatio:1.1678975712005124,width:209.77777777777777}}}]},{type:"text",text:" to give it a different look and feel"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"arrow_forward",native:"▶️"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Try present mode"},{type:"text",text:" and use your arrow keys and "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"UGnAU"}}],text:"spotlight"},{type:"footnote",attrs:{noteId:"UGnAU"},content:[{type:"paragraph",attrs:{horizontalAlign:null,fontSize:null},content:[{type:"text",text:"Spotlight lets you"},{type:"text",marks:[{type:"bold"}],text:" focus "},{type:"text",text:"on"},{type:"text",marks:[{type:"bold"}],text:" one piece of content at a time. "},{type:"text",text:"While presenting, press "},{type:"text",marks:[{type:"code"}],text:"s"},{type:"text",text:" to enter spotlight mode."}]},{type:"image",attrs:{id:"YOFhU",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/ed0b362f6c2f4a438cd3188ba7697a02/optimized/spotlight-compressed.gif",tempUrl:"blob:https://gamma.app/d2eaae7f-515e-4e06-b396-4b0551a5a999",uploadStatus:0,meta:{width:1200,height:750,date_file_modified:"2023/01/13 21:48:00 GMT",duration:6.66,aspect_ratio:1.6,has_clipping_path:!1,frame_count:34,colorspace:"RGB",average_color:"#323030"},providerMeta:null,name:"spotlight-compressed.gif",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]},{type:"text",text:" to move around"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"tada",native:"\uD83C\uDF89"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Share your deck"},{type:"text",text:"."},{type:"text",marks:[{type:"bold"}],text:" "},{type:"text",text:"Publish it to the world, invite others, or export a PDF"}]}]}]}]}}},86297:function(t,e,n){n.d(e,{R$:function(){return o.R$},VK:function(){return o.VK},j4:function(){return o.j4},vL:function(){return o.vL}});var o=n(95876)},51180:function(t,e,n){n.d(e,{R:function(){return u},p:function(){return l}});var o=n(96412),r=n(13089),a=n(72338),i=n(27191),s=n(69180),c=new i.H$("yDocSize"),u=function(t){var e=c.getState(t.state);return e?e.getYDocSize():null},l=a.hj.create({name:"yDocSize",addProseMirrorPlugins:function(){var t=this.options.document;return[new i.Sy({key:c,state:{init:function(){return new d(t)},apply:function(t,e){return e}}})]}}),d=function(){function t(e){(0,o.Z)(this,t),this.ydoc=e}return(0,r.Z)(t,[{key:"getYDocSize",value:function(){return s.D$(this.ydoc).byteLength}}]),t}()},89814:function(t,e,n){n.d(e,{g:function(){return u},j:function(){return l}});var o=n(18149),r=n.n(o),a=n(2784),i=n(46358),s=n(62141),c=n(24336),u=function(t){var e=(0,i.CG)(s.k8,function(){return r().apply(void 0,arguments)});return(0,a.useMemo)(function(){return{enabled:!!(t&&e&&(0,c.Jg)(t,e)),pos:null==e?void 0:e.pos}},[t,e])},l=function(t){var e=(0,i.CG)(s.ks),n=(0,i.CG)(s.Vt,function(){return r().apply(void 0,arguments)});(0,a.useEffect)(function(){if(t&&e&&n){console.debug("[useScrollAndSpotlightSync] collaboratorBeingFollowed spotlight or scroll changed",JSON.stringify(n,null,2));var o=n.spotlight,r=n.scroll;t.commands.syncSpotlightAndScroll({spotlight:o,scroll:r,scrollOffset:100,isFollowing:!0})}},[t,e,n])}},91718:function(t,e,n){n.d(e,{$1:function(){return o.$1},jB:function(){return r.j}});var o=n(24336),r=n(89814)},36738:function(t,e,n){n.d(e,{Ge:function(){return e6},yE:function(){return M.y},fb:function(){return ne.f},R$:function(){return nt.R$},VK:function(){return nt.VK},yg:function(){return M.e},vL:function(){return nt.vL}});var o,r,a,i=n(52780);i.tk.prototype.updateState=function(t){this.docView&&this.updateStateInner(t,this.state.plugins!=t.plugins)};var s=n(81333),c=n(76133),u=n(53738),l=n(27302),d=n(71354),f=n(420),p=n(91012),h=n(79522),v=n(44058),m=n(64652),y=n(2784),g=n(91760),b=n(69180),w=n(37914),k=n(23313),S=n(91354),A=n(8699),x=n(51180),P=n(10710),M=n(82477),D=n(72338),C=n(27191),O=n(46988),j=n(46358),E=n(60636),I=n(34264);function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var _=function(){var t=document.createElement("span");t.classList.add("collaboration-cursor__caret","streaming-cursor"),t.setAttribute("style","border-color: var(--chakra-colors-trueblue-100)");var e=document.createElement("div");return e.classList.add("collaboration-cursor__label","streaming-cursor__label"),e.setAttribute("style","background-color: var(--chakra-colors-trueblue-100); color: var(--chakra-colors-trueblue-400)"),t.insertBefore(e,null),t},T=D.hj.create({name:"aiGeneration",addOptions:function(){return{provider:null}},addStorage:function(){return{generationEnabled:!1}},onCreate:function(){var t=this.options.provider;t&&t.awareness&&t.awareness.on("change",function(){var e,n=!1,o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return R(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(t,e)}}(t))){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}(t.awareness.getStates());try{for(o.s();!(e=o.n()).done;){var r=(0,s.Z)(e.value,2),a=r[0];r[1].isStreaming&&a!==t.awareness.clientID&&(n=!0)}}catch(t){o.e(t)}finally{o.f()}var i=(0,j.bh)();(0,O.nl)(i.getState())!==n&&i.dispatch((0,O.R4)(n))})},addCommands:function(){var t=this;return{setAIGenerationRunning:function(e){return function(){var n;return t.storage.generationEnabled=e,null===(n=t.options.provider)||void 0===n||n.awareness.setLocalStateField("isStreaming",e),!0}}}},addProseMirrorPlugins:function(){var t=this.storage;return[new C.Sy({key:new C.H$("aiGeneration"),props:{decorations:function(e){if(!t.generationEnabled)return i.EH.empty;var n=[],o=e.doc.content.size-2,r=(0,D.qv)(e.doc.resolve(o),I.KH),a=r?(0,E.t)(e.doc.resolve(r.pos),-1):null;return a&&r&&(n.push(i.p.widget(a.from,_,{key:"sal",side:10})),n.push(i.p.node(r.pos,r.pos+r.node.nodeSize,{class:"ai-generate-streaming-card"}))),i.EH.create(e.doc,n)}}})]}}),Z=n(47507),z=D.hj.create({name:"aiModifications",onCreate:function(){var t=this;this.options.document.on("afterAllTransactions",function(e){var n=Z.i.getState(t.editor.view.state);n&&n.flushMoveInstructionQueue(t.editor.view.state)})},addProseMirrorPlugins:function(){return[new C.Sy({key:Z.i,state:{init:function(){return new Z.Y},apply:function(t,e,n,o){return e.apply(t,o)}}})]},addCommands:function(){return{setInteractionRange:function(t,e){return function(n){return n.tr.setMeta("aiModificationAction",{type:"setInteractionRange",rangeId:t,range:e}),!0}}}}}),B=n(44713),L=n(34676),U=n(95472),N=D.hj.create({name:"salExtension",addStorage:function(){return{salPanelOpen:!1}},addProseMirrorPlugins:function(){var t,e;return[(t=this.editor,e=this.storage,new C.Sy({props:{attributes:function(){return e.salPanelOpen?{class:"sal-active"}:{class:""}},decorations:function(n){var o=n.doc,r=n.selection;if(e.salPanelOpen){var a=r.from,s=r.to,c=[];return(0,U.Ru)(r.$from,I.KH).forEach(function(t,e){c.push(i.p.node(t.pos,t.pos+t.node.nodeSize,{class:(0,L.cx)(0==e?"sal-active-card":"sal-active-card-parent")}))}),(0,U.KB)(t)||(r instanceof C.Bs?c.push(i.p.inline(a,s,{class:(0,L.cx)("sal-selection-text")})):r instanceof C.qv&&c.push(i.p.node(a,s,{class:(0,L.cx)("sal-selection-node")}))),i.EH.create(o,c)}}}}))]},addCommands:function(){var t=this;return{setSalOpen:function(e){return function(n){return n.state,n.dispatch,t.storage.salPanelOpen=e,!0}}}}}),H=n(95235),q=n(38564),V=n(54073),F=n.n(V),G=n(26151),K=n(98875),$=n(96412),Y=n(13089),W=n(41701),Q=n(90129),J=n(29017),X=n(48200),tt=n(71657);function te(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}a=Symbol.iterator;var tn=function(t){(0,Q.Z)(o,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,X.Z)(o);if(e){var r=(0,X.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,J.Z)(this,t)});function o(t){(0,$.Z)(this,o),e=n.call(this),(0,H.Z)((0,W.Z)(e),"yarray",void 0),e.yarray=t,e.doc=t.doc,e.map=new Map;var e,r=t.toArray();return e.doc.transact(function(n){for(var o=r.length-1;o>=0;o--){var a=r[o];e.map.has(a.key)?t.delete(o):e.map.set(a.key,a)}}),t.observe(function(n){var o=new Map,r=Array.from(n.changes.added);n.changes.deleted.forEach(function(t){t.content.getContent().forEach(function(t){e.map.get(t.key)===t&&(e.map.delete(t.key),o.set(t.key,{action:"delete",oldValue:t.val}))})});var a=new Map;r.map(function(t){return t.content.getContent()}).flat().forEach(function(t){a.set(t.key,t)});var i=new Set,s=t.toArray();e.doc.transact(function(n){for(var r=s.length-1;r>=0&&(a.size>0||i.size>0);r--){var c=s[r];if(i.has(c.key))i.delete(c.key),t.delete(r,1);else if(a.get(c.key)===c){var u=e.map.get(c.key);if(u)i.add(c.key),o.set(c.key,{action:"update",oldValue:u.val,newValue:c.val});else{var l=o.get(c.key);l&&"delete"===l.action?o.set(c.key,{action:"update",newValue:c.val,oldValue:l.oldValue}):o.set(c.key,{action:"add",newValue:c.val})}a.delete(c.key),e.map.set(c.key,c)}else a.has(c.key)&&(i.add(c.key),a.delete(c.key))}}),o.size>0&&e.emit("change",[o])}),e}return(0,Y.Z)(o,[{key:a,value:function(){return this.yarray[Symbol.iterator]()}},{key:"values",value:function(){var t=this.yarray.length,e=-1;return(0,H.Z)({},Symbol.iterator,function(){return{next:function(){return++e===t?{value:void 0,done:!0}:{value:this.yarray.get(e),done:!1}}}})}},{key:"forEach",value:function(t){return this.yarray.forEach(t)}},{key:"set",value:function(t,e){var n=this;return this.doc.transact(function(o){n.map.has(t)&&n.delete(t),n.yarray.push([{key:t,val:e}])}),e}},{key:"delete",value:function(t){var e,n=0,o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return te(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return te(t,e)}}(t))){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}(this.yarray);try{for(o.s();!(e=o.n()).done;){if(e.value.key===t){this.yarray.delete(n);break}n++}}catch(t){o.e(t)}finally{o.f()}}},{key:"get",value:function(t){var e=this.map.get(t);return e&&e.val}},{key:"has",value:function(t){return this.map.has(t)}}]),o}(tt.y);function to(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var tr=function(t){(0,Q.Z)(o,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,X.Z)(o);if(e){var r=(0,X.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,J.Z)(this,t)});function o(){var t;(0,$.Z)(this,o);for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];return t=n.call.apply(n,[this].concat(r)),(0,H.Z)((0,W.Z)(t),"name","AnnotationsYKeyValue"),t}return(0,Y.Z)(o,[{key:"createKeyValue",value:function(t,e){var n=t.getArray(e);return new tn(n)}},{key:"getRestoreMap",value:function(t){return t.getMap("annotationsAbsolute")}},{key:"run",value:function(t){var e,n=this.createKeyValue(t,"annotationsAbsoluteKV"),o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return to(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return to(t,e)}}(t))){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}(this.getRestoreMap(t).entries());try{for(o.s();!(e=o.n()).done;){var r=(0,s.Z)(e.value,2),a=r[0],i=r[1];n.set(a,i)}}catch(t){o.e(t)}finally{o.f()}}}]),o}(function(){function t(){(0,$.Z)(this,t),(0,H.Z)(this,"name",void 0)}return(0,Y.Z)(t,[{key:"run",value:function(t){}}]),t}());function ta(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var ti=function(){function t(e){var n=this;(0,$.Z)(this,t),(0,H.Z)(this,"document",void 0),(0,H.Z)(this,"migrations",[new tr]),(0,H.Z)(this,"annotations",void 0),(0,H.Z)(this,"annotationsAbsolute",void 0),this.document=e,this.document.transact(function(){n.runMigrations()}),this.annotations=this.document.getMap("annotations"),this.annotationsAbsolute=new tn(this.document.getArray("annotationsAbsoluteKV"))}return(0,Y.Z)(t,[{key:"runMigrations",value:function(){var t,e=this.getMigrationsMap(),n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ta(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ta(t,e)}}(t))){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}(this.migrations);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(!this.hasRunMigration(o.name))try{o.run(this.document),e.set(o.name,!0)}catch(t){}}}catch(t){n.e(t)}finally{n.f()}}},{key:"getMigrationsMap",value:function(){return this.document.getMap(t.ANNOTATION_MIGRATIONS_KEY)}},{key:"hasRunMigration",value:function(t){return this.getMigrationsMap().get(t)||!1}}]),t}();(0,H.Z)(ti,"ANNOTATION_MIGRATIONS_KEY","annotationMigrations");var ts=function(){function t(e){(0,$.Z)(this,t),(0,H.Z)(this,"decoration",void 0),this.decoration=e}return(0,Y.Z)(t,[{key:"id",get:function(){return this.decoration.type.spec.id}},{key:"from",get:function(){return this.decoration.from}},{key:"data",get:function(){return this.decoration.type.spec.data}},{key:"HTMLAttributes",get:function(){return this.decoration.type.attrs}},{key:"toString",value:function(){return JSON.stringify({id:this.id,data:this.data,from:this.from,HTMLAttributes:this.HTMLAttributes})}}]),t}(),tc=n(10221),tu=n(12741),tl=n(84636),td=n.n(tl),tf=n(35838),tp=n.n(tf),th=n(9850),tv=n.n(th),tm=n(36069),ty=n(39428),tg=n(39875);function tb(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function tw(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?tb(Object(n),!0).forEach(function(e){(0,H.Z)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tb(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function tk(t){for(var e=[],n=t.length-1;n>=0;n--){var o=t[n];e.push(tw(tw({},o),{},{prev:o.next,next:o.prev}))}return e}var tS=function(){function t(e){(0,$.Z)(this,t),this.map=e,(0,H.Z)(this,"undoQueue",[])}return(0,Y.Z)(t,[{key:"flushUndoQueue",value:function(){var t=this.undoQueue;return this.undoQueue=[],t}},{key:"set",value:function(t,e){var n=this.map.get(t);return this.undoQueue.unshift({type:"set",key:t,next:n,prev:e}),this.map.set(t,e)}},{key:"delete",value:function(t){var e=this.map.get(t);return void 0===e||this.undoQueue.unshift({type:"set",key:t,next:e,prev:void 0}),this.map.delete(t)}}]),t}();function tA(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function tx(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?tA(Object(n),!0).forEach(function(e){(0,H.Z)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tA(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function tP(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return tM(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tM(t,e)}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function tM(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var tD=function(){function t(e){(0,$.Z)(this,t),this.options=e,(0,H.Z)(this,"decorations",i.EH.empty),(0,H.Z)(this,"annotations",[]),(0,H.Z)(this,"map",void 0),(0,H.Z)(this,"restoreMap",void 0),(0,H.Z)(this,"refreshDecorations",!1),(0,H.Z)(this,"hasChanges",!1),(0,H.Z)(this,"undoableMap",void 0),(0,H.Z)(this,"filmstripCutData",null),(0,H.Z)(this,"cutData",null),(0,H.Z)(this,"moveInstructionMap",{}),this.map=e.map,this.restoreMap=e.restoreMap,this.undoableMap=new tS(this.map)}return(0,Y.Z)(t,[{key:"persistRestoreMap",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o={deletion:0,relToAbs:0,setting:0,total:0},r=performance.now();(n||this.hasChanges)&&(this.transactYDoc(function(){var n,r=performance.now(),a=tP(e.restoreMap);try{for(a.s();!(n=a.n()).done;){var i=n.value.key;e.restoreMap.delete(i)}}catch(t){a.e(t)}finally{a.f()}o.deletion=performance.now()-r,e.map.forEach(function(n){var r=n.id,a=n.pos,i=n.data;try{var s=performance.now(),c=e.relToAbs(t,a);o.relToAbs+=performance.now()-s;var u=performance.now();e.restoreMap.set(r,{id:r,data:i,absPos:c}),o.setting+=performance.now()-u}catch(t){console.error("[Annotations] persistRestoreMap error: ",t.message)}})}),o.total=performance.now()-r,this.log("[Annotations] persistRestoreMap in ".concat(o.total,"ms"),{values:this.restoreMap.yarray.toArray(),performance:o}),this.hasChanges=!1)}},{key:"flushMoveInstructionQueue",value:function(){var t=this.moveInstructionMap;return this.moveInstructionMap={},Object.values(t)}},{key:"clearCutData",value:function(){this.cutData=null,this.filmstripCutData=null}},{key:"getAnnotationsBetween",value:function(t,e,n){var o,r=[],a=tP(this.map.values());try{for(a.s();!(o=a.n()).done;){var i=o.value;try{var s=this.relToAbs(t,i.pos);if(null===s)continue;e<=s&&s<n&&r.push({id:i.id,data:i.data,pos:s,relativePos:i.pos})}catch(t){console.warn("[Annotations] getAnnotationsBetween error: ",t.message)}}}catch(t){a.e(t)}finally{a.f()}return r}},{key:"apply",value:function(t,e){if(q.Gt.getState(e).isChangeOrigin){try{this.createDecorations(e)}catch(t){console.warn("[Annotations] handle remote change, not create decorations: ".concat(t.message))}return this}var n=t.getMeta(tc.Z);if(n){switch(n.type){case"addAnnotation":this.addAnnotation(n,e);break;case"restoreAnnotations":this.restoreAnnotations(n);break;case"clearAnnotations":this.clearAnnotations();break;case"deleteAnnotation":this.deleteAnnotation(n.id);break;case"refreshAnnotationDecorations":try{this.createDecorations(e)}catch(t){console.warn("could not create decorations: ".concat(t.message))}break;case"moveAnnotations":this.moveAnnotations(e,n.toMove)}return this.hasChanges=!0,this}switch(t.getMeta("uiEvent")){case"cut":this.handleCutTransaction(e,t);break;case"paste":this.handlePasteTransaction(e,t)}var o=t.getMeta("annotationEvent");switch(null==o?void 0:o.type){case"split-card":this.handleSplitCard(e,t,o);break;case"split-block":this.handleSplitBlock(e,t,o);break;case"join-forward":this.handleJoinForward(e,t,o);break;case"join-backward":this.handleJoinBackward(e,t,o);break;case"update-node-attrs":this.handleUpdateNodeAttrs(e,t,o);break;case"rearrange-cards":this.handleRearrangeCards(e,t,o);break;case"move":this.handleMove(e,t,o);break;case"merge-cards":this.handleMergeCards(e,t,o);break;case"drop":this.handleDropAnnotations(e,t,o);break;case"unwrap-node":this.handleUnwrapNode(e,t,o);break;case"wrap-nodes":this.handleWrapNodes(e,t,o);break;case"filmstrip-cut":this.handleFilmstripCut(e,t,o);break;case"filmstrip-paste":this.handleFilmstripPaste(e,t,o);break;default:t.getMeta("appendedTransaction")||(this.handleReplaceTransaction(e,t),this.handleReplaceAroundTransaction(e,t))}return t.docChanged&&(this.hasChanges=!0),this.handleLocalChange(t)}},{key:"restore",value:function(t,e){var n=this;e.forEach(function(e){var o=e.next,r=e.key;void 0===o?n.map.delete(r):n.map.set(r,tx(tx({},o),{},{pos:n.refreshRelativePos(t,o.pos)}))}),this.persistRestoreMap(t,!0)}},{key:"handleUnwrapNode",value:function(t,e,n){var o=this,r=n.pos,a=e.before.resolve(r),i=a.start(a.depth+1),s=e.before.resolve(i).end(),c=this.getAnnotationsBetween(t,i,s).map(function(e){var n=e.id,a=e.relativePos,s=o.relToAbs(t,a);return null===s?null:{id:n,newPos:r+(s-i)}}).filter(function(t){return!!t});this.log("%c[Annotations] unwrap node","color: green",{tr:e,pos:r,start:i,end:s,toMove:c}),c.length>0&&this.enqueueMoveInstructions(c)}},{key:"handleWrapNodes",value:function(t,e,n){var o=n.start,r=n.end,a=n.level,i=this.getAnnotationsBetween(t,o,r).map(function(t){return{id:t.id,newPos:t.pos+a}}).filter(function(t){return!!t});this.log("%c[Annotations] wrap nodes","color: green",{tr:e,start:o,end:r,toMove:i}),i.length>0&&this.enqueueMoveInstructions(i)}},{key:"handleMergeCards",value:function(t,e,n){var o=n.insertPos,r=n.contentPos,a=e.before.nodeAt(r);if(!a){console.error("[AnnotationState] trying to merge cards, but cannot resolve content wrapper");return}var i=this.getAnnotationsBetween(t,r,r+a.nodeSize).map(function(t){return{id:t.id,newPos:o+(t.pos-r-1)}});this.log("%c[Annotations] merge cards","color: green",{transaction:e,insertPos:o,contentPos:r,toMove:i}),i.length>0&&this.enqueueMoveInstructions(i)}},{key:"handleRearrangeCards",value:function(t,e,n){var o=this,r=n.rearrangedCardPositions,a=n.insertPos,i=r.flatMap(function(n){var r=n.newPos,a=n.oldPos,i=e.before.resolve(a);return o.getAnnotationsBetween(t,a,a+i.nodeAfter.nodeSize).map(function(t){return{id:t.id,newPos:r+(t.pos-a)}})}),s=[],c=(0,I.Y0)(e.before);if(c){var u=r[0].oldPos,l=Math.min(u,a),d=Math.max(u,a);s=c.flatMap(function(n){var a=n.node,i=n.pos;if(!(i>=l&&i<=d&&!r.find(function(t){return t.id===a.attrs.id})))return[];var s=e.before.resolve(i),c=i+s.nodeAfter.nodeSize;return o.getAnnotationsBetween(t,i,c).map(function(t){var n=t.id,o=t.pos;return{id:n,newPos:e.mapping.map(o)}})})}this.log("%c[Annotations] rearrange cards","color: green",{transaction:e,rearrangedCardPositions:r,annotationsInRearrangedCards:i,jumpedAnnotations:s});var f=[].concat((0,tu.Z)(i),(0,tu.Z)(s));f.length>0&&this.enqueueMoveInstructions(f)}},{key:"handleMove",value:function(t,e,n){var o=n.insertPos,r=n.insertPosRaw,a=n.pos,i=n.end,s=this.getAnnotationsBetween(t,a,i).map(function(t){return{id:t.id,newPos:o+(t.pos-a)}}),c=this.getAnnotationsBetween(t,Math.min(r,i),Math.max(r,a)).map(function(t){var n=t.id,o=t.pos;return{id:n,newPos:e.mapping.map(o)}});this.log("%c[Annotations] move","color: green",{transaction:e,insertPos:o,insertPosRaw:r,pos:a,end:i,annotationsInCard:s,jumpedAnnotations:c});var u=[].concat((0,tu.Z)(s),(0,tu.Z)(c));u.length>0&&this.enqueueMoveInstructions(u)}},{key:"handleUpdateNodeAttrs",value:function(t,e,n){var o=n.pos,r=e.doc.nodeAt(o);if(r){var a=this.getAnnotationsBetween(t,o,o+r.nodeSize).map(function(t){return{id:t.id,newPos:t.pos}});this.log("%c[Annotations] update node attrs","color: green",{transaction:e,pos:o,toMove:a}),a.length>0&&this.enqueueMoveInstructions(a)}}},{key:"handleJoinBackward",value:function(t,e,n){var o=this,r=n.atBeginning,a=n.joinPos;if(r){var i=e.before.resolve(a),s=e.before.resolve(i.before()),c=s.nodeBefore,u=s.nodeAfter;if(c&&u){var l=s.pos+u.nodeSize,d=s.pos-c.nodeSize,f=t.selection.from;this.log("%c[Annotations] join backward","color: green",{transaction:e,prevBlock:c,nextBlock:u,nextBlockPos:s.pos,nextBlockEnd:l,prevBlockPos:d,joinPoint:f});var p=this.getAnnotationsBetween(t,s.pos,l);if(0===p.length){this.enqueueRefreshDecorations();return}0===u.content.size?(p.forEach(function(t){var e=t.id;return o.undoableMap.delete(e)}),requestAnimationFrame(function(){o.writeUndoStack(t)})):this.enqueueMoveInstructions(p.map(function(t){var e=t.id,n=Math.max(t.pos-s.pos-1,0);return{id:e,newPos:(0===c.content.size?d:f)+n}}))}}}},{key:"handleJoinForward",value:function(t,e,n){var o=this,r=n.atEnd,a=n.joinPos;if(r){var i=e.before.resolve(a),s=(0,U.nv)(i,function(t){return t.isBlock})[0],c=s.pos,u=s.node,l=e.before.resolve(i.after()),d=l.nodeAfter;if(d){var f=l.pos+d.nodeSize;this.log("%c[Annotations] join forward","color: green",{sel:t.selection,prevBlock:u,transaction:e,deleteAnnotations:!!d.isAtom,joinPos:i.pos,prevBlockPos:c,nextBlockPos:l.pos,nextBlock:d});var p=this.getAnnotationsBetween(t,c,c+u.nodeSize),h=this.getAnnotationsBetween(t,l.pos,f);if(0===h.length&&0===p.length){this.enqueueRefreshDecorations();return}var v=function(e){e.forEach(function(t){var e=t.id;return o.undoableMap.delete(e)}),requestAnimationFrame(function(){o.writeUndoStack(t)})};d.isAtom&&u.content.size>0?v(h):0===u.content.size?v(p):this.enqueueMoveInstructions(h.map(function(t){var e=t.id,n=Math.max(t.pos-l.pos-1,0);return{id:e,newPos:(0===u.content.size?c:a)+n}}))}}}},{key:"handleSplitBlock",value:function(t,e,n){var o=n.splitPos;if(n.atBeginning){this.enqueueRefreshDecorations();return}var r=e.before.resolve(o),a=(0,U.nv)(r,function(t){return t.isBlock})[0],i=a.pos,s=a.node,c=t.selection.$from,u=(0,U.nv)(c,function(t){return t.isBlock})[0],l=this.getAnnotationsBetween(t,o,i+s.nodeSize).map(function(t){var e=t.id,n=t.pos-o;return{id:e,newPos:u.pos+(0===n?n:n+1)}});l.length>0?this.enqueueMoveInstructions(l):this.enqueueRefreshDecorations(),this.log("%c[Annotations] split block","color: green",{sel:t.selection,transaction:e,splitPos:o,toMove:l,$before:r})}},{key:"handleSplitCard",value:function(t,e,n){var o=n.splitPos,r=e.before.resolve(o),a=(0,U.nv)(r,I.KH)[0];if(a){var i=a.pos,s=a.pos+a.node.nodeSize,c=this.getAnnotationsBetween(t,i,s).map(function(t){var n=t.id,r=t.pos;return{id:n,newPos:r===o?e.mapping.map(r+1)-1:e.mapping.map(r)}});this.log("%c[Annotations] split card","color: green",{transaction:e,splitPos:o,parentEnd:s,toMove:c}),this.enqueueMoveInstructions(c)}}},{key:"handlePasteTransaction",value:function(t,e){if(this.cutData||this.filmstripCutData){var n=e.steps.find(function(t){return"replace"===t.jsonID});if(n){var o=n.from,r=n.to,a=n.slice.openStart,i=t.doc.resolve(n.from),s=r===o?o:o+1,c=null==i.nodeBefore&&i.parent.isBlock,u=!a||c;if(this.log("%c[Annotations] paste transaction","color: green",{transaction:e,insertPos:o,resolved:i,isPasteBeginning:c,pasteType:this.cutData?"cut":"filmstrip-cut"}),this.cutData){var l=this.cutData;this.cutData=null;var d=l.toMove.map(function(t){var e=t.id,n=t.offset;return{id:e,newPos:s+(u?n:Math.max(0,n))}});d&&d.length>0&&(this.log("[Annotations] paste from cut final move",d),this.enqueueMoveInstructions(d))}else if(this.filmstripCutData){var f=this.filmstripCutData;this.filmstripCutData=null;for(var p=s-1;p<t.doc.nodeSize;){var h=t.doc.nodeAt(p);if(h&&(0,I.KH)(h))break;p++}var v=this.getMoveInstructionsForFilmstripPaste(e,f,p);v&&v.length>0&&(this.log("[Annotations] paste from filmstrip cut final move",v),this.enqueueMoveInstructions(v))}}}}},{key:"getMoveInstructionsForFilmstripPaste",value:function(t,e,n){if(e){var o=(0,D.N2)(t.doc,I.KH);if(o){var r=t.doc.resolve(n).depth,a=o.filter(function(e){var n=e.pos;return t.doc.resolve(n).depth===r}),i=a.findIndex(function(t){return t.pos===n});if(-1!==i){var s=a.slice(i);return e.flatMap(function(t){var e=t.cardIndex;return t.annotations.map(function(t){var n=t.id,o=t.offset,r=s[e];if(r)return{id:n,newPos:r.pos+o}}).filter(function(t){return!!t})})}}}}},{key:"handleFilmstripPaste",value:function(t,e,n){if(this.cutData||this.filmstripCutData){var o=n.insertPos;if(this.cutData){var r=this.cutData;this.cutData=null;var a=r.toMove.map(function(t){return{id:t.id,newPos:o+t.offset}});a&&a.length>0&&(this.log("[Annotations] filmstripPaste from cut final move",{tr:e,cutData:r,moveInstructions:a}),this.enqueueMoveInstructions(a))}else if(this.filmstripCutData){var i=this.filmstripCutData;this.filmstripCutData=null;var s=this.getMoveInstructionsForFilmstripPaste(e,i,o);s&&s.length>0&&(this.log("%c[Annotations] filmstripPaste from filmstrip cut final move","color: green",{tr:e,filmstripCutData:i,moveInstructions:s}),this.enqueueMoveInstructions(s))}}}},{key:"handleFilmstripCut",value:function(t,e,n){var o=this;this.cutData=null,this.filmstripCutData=n.deleted.map(function(n){var r=n.cardIndex,a=n.pos,i=e.before.resolve(a),s=a+i.nodeAfter.nodeSize;return{cardIndex:r,annotations:o.getAnnotationsBetween(t,a,s).map(function(t){return{id:t.id,offset:t.pos-a}})}}),this.log("%c[Annotations] filmstripCut","color: green",{tr:e,filmstripCutData:this.filmstripCutData})}},{key:"handleCutTransaction",value:function(t,e){var n=this,o=e.steps.find(function(t){return"replace"===t.jsonID});if(o){this.filmstripCutData=null;var r=o.from,a=o.to,i=t.doc.resolve(r),s=null==i.nodeAfter&&null==i.nodeBefore&&i.parent.isBlock,c=this.getAnnotationsBetween(t,r-(s?1:0),a),u=c.map(function(e){var o=n.relToAbs(t,e.relativePos);return{id:e.id,offset:o-r}});this.cutData={slice:o.slice,toMove:u},this.log("%c[Annotations] cut transaction","color:green",{isWholeBlock:s,resolved:i,transaction:e,annotations:c,moveData:u})}}},{key:"handlePrependContentToBlock",value:function(t,e){var n=this,o=e.steps.find(function(t){return"replace"===t.jsonID});if(o){var r=o.from,a=e.before.resolve(r);if(a.nodeAfter){var i=this.getAnnotationsBetween(t,r,r+a.nodeAfter.nodeSize).map(function(o){var a=o.id,i=o.relativePos,s=n.relToAbs(t,i);return{id:a,newPos:s===r?e.mapping.map(s+1)-1:e.mapping.map(s)}});i.length>0&&(this.log("%c[Annotations] replace transaction - prepend content","color:green",{tr:e,annotationsToMove:i}),this.enqueueMoveInstructions(i))}}}},{key:"handleReplaceTransaction",value:function(t,e){var n=this,o=e.steps.find(function(t){return"replace"===t.jsonID});if(o){var r=o.from,a=o.to,i=e.before.resolve(r),s=e.before.resolve(a),c=i.parent!==s.parent,u=0==o.slice.content.size,l=0===i.parentOffset&&a>=r+i.parent.nodeSize-2,d=l&&u;if(0===s.parentOffset&&s.depth===i.depth+1&&s.pos-i.pos==1)return this.handlePrependContentToBlock(t,e);var f=!1;if(c){var p,h=d?[]:this.getAnnotationsBetween(t,r-i.parentOffset-1,r).map(function(e){var o=e.id,r=e.relativePos;return{id:o,newPos:n.relToAbs(t,r)}}),v=this.getAnnotationsBetween(t,a,a+(null===(p=s.nodeAfter)||void 0===p?void 0:p.nodeSize)+1).map(function(o){var r=o.id,a=o.relativePos;return{id:r,newPos:e.mapping.map(n.relToAbs(t,a))}}),m=[].concat((0,tu.Z)(h),(0,tu.Z)(v));this.log("[Annotations] multiline to move",m),m.length>0&&(f=!0,this.enqueueMoveInstructions(m))}var y=this.getAnnotationsBetween(t,r-(d||c&&0===i.parentOffset?1:0),a);y.length>0&&(f=!0,this.log("[Annotations] to delete",y),y.forEach(function(t){n.undoableMap.delete(t.id)})),f&&(this.log("%c[Annotations] replace transaction","color:green",{tr:e,annotationsToDelete:y,isWholeBlock:d,isMultiline:c,replacingEntireFromBlock:l,replacingWithNothing:u}),requestAnimationFrame(function(){n.writeUndoStack(t)}))}}},{key:"handleReplaceAroundTransaction",value:function(t,e){var n=this,o=tp()(e.steps.filter(function(t){return"replaceAround"===t.jsonID}),function(e){var o=e.from,r=e.to;return n.getAnnotationsBetween(t,o,r)}),r=td()(o,function(t){return t.id}).map(function(t){var n=t.id,o=t.pos;return{id:n,newPos:e.mapping.map(o)}});return r.length>0&&this.log("%c[Annotations] replaceAround transaction","color:green",{tr:e,moveInsturctions:r}),0!==r.length&&(this.enqueueMoveInstructions(r),!0)}},{key:"clearAnnotations",value:function(){var t=this;this.transactYDoc(function(){t.map.forEach(function(e,n){t.map.delete(n)})})}},{key:"restoreAnnotations",value:function(t){this.log("%c[Annotations] restoreAnnotations","color: green",t);var e=t.toRestore;this.clearAnnotations(),this.enqueueMoveInstructions(e.filter(function(t){return null!=t.absPos}).map(function(t){var e=t.absPos;return{id:t.id,newPos:e}}))}},{key:"addAnnotation",value:function(t,e){this.log("%c[Annotations] addAnnotation","color: green",t);var n=t.pos,o=t.id,r=t.data,a=this.absToRel(e,n);this.map.set(o,{id:o,pos:a,data:r})}},{key:"deleteAnnotation",value:function(t){this.log("%c[Annotations] deleteAnnotation","color: green",t),this.map.delete(t)}},{key:"moveAnnotations",value:function(t,e){var n=this,o=this.map;this.log("%c[Annotations] moveAnnotations","color: green",e),this.transactYDoc(function(){e.forEach(function(e){var r=e.id,a=e.newPos,i=o.get(r)||{id:r};n.undoableMap.set(r,tx(tx({},i),{},{pos:n.absToRel(t,a)}))})}),this.writeUndoStack(t)}},{key:"writeUndoStack",value:function(t){var e=q.Gk.getState(t).undoManager;if(0!==e.undoStack.length){var n=this.undoableMap.flushUndoQueue();if(0!==n.length){var o=e.undoStack[e.undoStack.length-1],r="annotations",a=o.meta.get(r)||[];a.length>0&&this.log("[Annotations] existing undo stack",{existing:a,toWrite:n,stack:e.undoStack});var i=[].concat((0,tu.Z)(n),(0,tu.Z)(a));o.meta.set(r,i),this.log("[Annotations] writing to undo stack",i)}}}},{key:"createDecorations",value:function(t){var e=this.options.map;this.refreshDecorations=!1;var n=[],o=[];e.forEach(function(e,r){var a=(0,ty.XV)(t,e.pos);if(null!=a){var s=t.doc.nodeAt(a);s&&(null!=s&&s.isInline?n.push(i.p.inline(a,a+1,{class:"debug-comment-cursor"})):n.push(i.p.node(a,a+s.nodeSize,{class:"debug-comment-block"}))),o.push({id:r,data:e.data,relativePos:e.pos,pos:a})}}),t.doc.descendants(function(t,e,r){return!!(!(e>0)||(0,tg.ZM)(r)||(0,tg.ZM)(t))&&(o.filter(function(n){return n.pos>=e&&n.pos<e+t.nodeSize}).forEach(function(o){var r=o.id,a=o.data;n.push(i.p.node(e,e+t.nodeSize,{},{isAnnotation:!0,id:r,data:a}))}),!0)}),this.decorations=i.EH.create(t.doc,n),this.annotations=o}},{key:"handleDropAnnotations",value:function(t,e,n){var o=n.dragging,r=o.origNodePos,a=o.inBlock,i=o.inCard,s=n.droppedBlockPos,c=[];a.forEach(function(t){var e=s+(t.pos-r);c.push({id:t.id,newPos:e})}),this.getAnnotationsBetween(t,s,s+1).filter(function(t){return!c.find(function(e){return e.id===t.id})}).forEach(function(t){c.push({id:t.id,newPos:e.mapping.map(t.pos)})}),i.filter(function(t){return!c.find(function(e){return e.id===t.id})}).forEach(function(t){var n=e.mapping.map(t.pos);c.push({newPos:n,id:t.id})}),this.log("%c[Annotations] handleDropAnnotations","color: green",{action:n,tr:e,toMove:c}),c.length>0&&this.enqueueMoveInstructions(c)}},{key:"handleLocalChange",value:function(t){var e=this,n=(0,tu.Z)(this.decorations.find(void 0,void 0,function(t){return t.isAnnotation&&e.moveInstructionMap[t.id]})),o=this.decorations.remove(tv()(n)).map(t.mapping,t.doc).add(t.doc,n);return this.decorations=o,this}},{key:"absToRel",value:function(t,e){var n=(0,ty.jS)(t,e);if(!n)throw Error("Y.State non initialized");return n}},{key:"relToAbs",value:function(t,e){return(0,ty.XV)(t,e)}},{key:"refreshRelativePos",value:function(t,e){var n=q.Gt.getState(t),o=n.doc,r=n.type,a=n.binding,i=(0,tm.SF)(o,r,e,a.mapping);return(0,tm.JR)(i,r,a.mapping)}},{key:"enqueueMoveInstructions",value:function(t){var e=this;t.forEach(function(t){e.moveInstructionMap[t.id]&&console.error("[AnnotationState] trying to enqueue two move instructions for annotation with targetId=".concat(t.id)),e.moveInstructionMap[t.id]=t})}},{key:"enqueueRefreshDecorations",value:function(){this.refreshDecorations=!0}},{key:"transactYDoc",value:function(t){this.options.document.transact(t)}},{key:"log",value:function(){var t,e;K.VH.get("debugComments")?(t=console).log.apply(t,arguments):(e=console).debug.apply(e,arguments)}}]),t}(),tC=function(t){var e=F()(function(t){tc.Z.getState(t.state).persistRestoreMap(t.state)},500);return new C.Sy({key:tc.Z,state:{init:function(){return new tD(t)},apply:function(t,e,n,o){return e.apply(t,o)}},view:function(){return{update:function(t){e(t)}}},props:{transformPasted:function(e){var n,o=this.getState(t.editor.state),r=null===(n=e.content.firstChild)||void 0===n?void 0:n.attrs.docId;return r&&r!==t.editor.gammaDocId&&o.clearCutData(),e},handleDOMEvents:{copy:function(t){return this.getState(t.state).clearCutData(),!1}},decorations:function(e){var n=this.getState(e),o=n.decorations,r=n.annotations;return t.onUpdate&&t.onUpdate(o.find().map(function(t){return new ts(t)}),r),o}}})};function tO(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function tj(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?tO(Object(n),!0).forEach(function(e){(0,H.Z)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tO(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var tE=D.hj.create({name:"annotation",onCreate:function(){var t=this,e=function(){var t,e;K.VH.get("debugComments")?(t=console).log.apply(t,arguments):(e=console).debug.apply(e,arguments)};this.options.document.on("afterAllTransactions",function(n){var o=tc.Z.getState(t.editor.view.state),r=o.flushMoveInstructionQueue();r.length>0?(e("%c[Annotations] afterAllTransactions handling queued moves","color:pink",r),t.editor.commands.moveAnnotations(r)):o.refreshDecorations&&(e("%c[Annotations] afterAllTransactions refreshDecorations","color:pink"),t.editor.commands.refreshDecorations())});var n=tc.Z.getState(this.editor.state);window.gammaAnnotations=n;var o=q.Gk.getState(this.editor.state).undoManager;setTimeout(function(){o.on("stack-item-popped",function(e){var r=e.stackItem.meta.get("annotations");if(!r){n.persistRestoreMap(t.editor.state,!0);return}var a=o.undoStack,i=o.redoStack;"undo"===e.type&&i.length>0?i[i.length-1].meta.set("annotations",tk(r)):"redo"===e.type&&a.length>0&&a[a.length-1].meta.set("annotations",tk(r)),n.restore(t.editor.state,r)})},0),n.map.observe(F()(function(){e("[Annotations] map observe -> resfreshDecorations"),t.editor.commands.refreshDecorations()})),this.editor.commands.refreshDecorations()},addCommands:function(){return{restoreAnnotations:function(t){return function(e){var n=e.dispatch,o=e.tr;return n&&(o.setMeta(tc.Z,{type:"restoreAnnotations",toRestore:Object.values(t)}),n(o)),!0}},updateAttributes:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var o,r,a=n.tr,i=n.state,s=n.dispatch,c=null,u=null,l=(o="string"==typeof t?t:t.name,(r=i.schema).nodes[o]?"node":r.marks[o]?"mark":null);return!!l&&("node"===l&&(c=(0,D.jo)(t,i.schema)),"mark"===l&&(u=(0,D.TP)(t,i.schema)),s&&a.selection.ranges.forEach(function(t){var n=t.$from.pos,o=t.$to.pos;i.doc.nodesBetween(n,o,function(t,r){c&&c===t.type&&a.setNodeMarkup(r,void 0,tj(tj({},t.attrs),e)).setMeta("annotationEvent",{type:"update-node-attrs",pos:r}),u&&t.marks.length&&t.marks.forEach(function(i){if(u===i.type){var s=Math.max(r,n),c=Math.min(r+t.nodeSize,o);a.addMark(s,c,u.create(tj(tj({},i.attrs),e)))}})})}),!0)}},wrapWithAnnotations:function(t,e){return function(n){var o=n.state,r=n.tr,a=n.dispatch,i=o.schema.nodes[t],s=o.selection,c=s.$from,u=s.$to,l=c.blockRange(u),d=l&&(0,G.nd)(l,i,e);if(!d||!l)return!1;var f=l.start,p=l.end;return!a||(r.wrap(l,d).setMeta("annotationEvent",{type:"wrap-nodes",start:f,end:p,level:1}).scrollIntoView(),!0)}},moveAnnotations:function(t){return function(e){var n=e.dispatch,o=e.tr;return n&&(o.setMeta(tc.Z,{type:"moveAnnotations",toMove:t}),n(o)),!0}},clearAnnotations:function(){return function(t){var e=t.dispatch,n=t.tr;return e&&(n.setMeta(tc.Z,{type:"clearAnnotations"}),e(n)),!0}},refreshDecorations:function(){return function(t){var e=t.dispatch,n=t.tr;return e&&(n.setMeta(tc.Z,{type:"refreshAnnotationDecorations"}),e(n)),!0}},addAnnotation:function(t){var e=t.pos,n=t.id,o=t.data;return function(t){var r=t.dispatch,a=t.state;return r&&a.tr.setMeta(tc.Z,{type:"addAnnotation",id:n,data:o,pos:e}),!0}},deleteAnnotation:function(t){return function(e){var n=e.dispatch,o=e.state;return n&&o.tr.setMeta(tc.Z,{type:"deleteAnnotation",id:t}),!0}}}},addProseMirrorPlugins:function(){var t=this.options,e=t.document,n=t.onUpdate,o=new ti(e);return[tC({document:e,editor:this.editor,map:o.annotations,restoreMap:o.annotationsAbsolute,onUpdate:n})]}}),tI=n(52527),tR=D.hj.create({name:"draftComments",addCommands:function(){return{removeDraftComments:function(t){return function(e){var n=e.dispatch,o=e.tr;if(n){var r={type:"removeDraftComment",comments:Array.isArray(t)?t:[t]};o.setMeta(tI.N,r),n(o)}return!0}},createDraftComment:function(t){return function(e){var n=e.dispatch,o=e.tr;return n&&(o.setMeta(tI.N,{type:"createDraftComment",comment:t}),n(o)),!0}}}},addProseMirrorPlugins:function(){return[(0,tI.O)()]}}),t_=n(9734),tT=new C.H$("mobileAnnotationPluginKey"),tZ=function(){function t(){(0,$.Z)(this,t),(0,H.Z)(this,"pos",null),(0,H.Z)(this,"timeout",void 0)}return(0,Y.Z)(t,[{key:"apply",value:function(t,e){var n=t.getMeta(tT);return n&&"setPos"in n&&(this.pos=n.setPos),this}}]),t}(),tz=D.hj.create({name:"mobileAnnotation",addCommands:function(){return{setMobileAddBlockComment:function(t){return function(e){var n=e.dispatch,o=e.tr,r=e.view;if(!n)return!1;if(null===t)return o.setMeta(tT,{setPos:null}),n(o),!0;var a=t.clientX,i=t.clientY,s=r.posAtCoords({left:a,top:i});if(null===s)return!0;var c=(0,tg.f$)(s.inside,r);if(!c)return!1;var u=r.coordsAtPos(c.pos),l=a-u.left,d=i-u.top;return o.setMeta(tT,{setPos:{pos:c.pos,end:c.end,offsetX:l,offsetY:d}}),n(o),!0}}}},addProseMirrorPlugins:function(){var t;return[(t=this.editor,new C.Sy({key:tT,state:{init:function(){return new tZ},apply:function(t,e,n,o){return e.apply(t,o)}},props:{handleDOMEvents:{click:function(e,n){if(!(0,t_.s2)())return!1;if(!n.target.closest("[data-comments-wrapper]")){var o=tT.getState(e.state);o.pos||(o.timeout?(clearTimeout(o.timeout),o.timeout=null,t.commands.setMobileAddBlockComment(n)):o.timeout=setTimeout(function(){o.timeout=null},300))}}},decorations:function(t){var e=tT.getState(t).pos;if(null===e)return i.EH.empty;var n=i.p.node(e.pos,e.end,{},{isMobileAnnotation:!0,type:"show-buttons",offsetX:e.offsetX,offsetY:e.offsetY});return i.EH.create(t.doc,[n])}}}))]}}),tB=n(99638),tL=D.hj.create({name:"BlockHover",addProseMirrorPlugins:function(){return[(0,tB.RT)(this.editor)]}}),tU=n(41962),tN=n(56143),tH=n(47684),tq=n(66902),tV=D.hj.create({name:"collaboration",priority:tq.a.Collaboration,addOptions:function(){return{document:null,field:"default",fragment:null}},onCreate:function(){this.editor.extensionManager.extensions.find(function(t){return"history"===t.name})&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands:function(){return{undo:function(){return function(t){var e=t.tr,n=t.state,o=t.dispatch;return e.setMeta("preventDispatch",!0),0!==q.Gk.getState(n).undoManager.undoStack.length&&(!o||(0,tN.Yw)(n)||!0)}},redo:function(){return function(t){var e=t.tr,n=t.state,o=t.dispatch;return e.setMeta("preventDispatch",!0),0!==q.Gk.getState(n).undoManager.redoStack.length&&(!o||(0,tN.KX)(n)||!0)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-z":function(){return t.editor.commands.undo()},"Mod-y":function(){return t.editor.commands.redo()},"Shift-Mod-z":function(){return t.editor.commands.redo()}}},addProseMirrorPlugins:function(){var t=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field);return[(0,tH.Z)(t),(0,tN.v0)(),new C.Sy({appendTransaction:function(t,e,n){if(t.some(function(t){return!1==t.getMeta("addToHistory")})){var o=n.tr;return o.setMeta("addToHistory",!1),o}return null}})]}}),tF=n(67702),tG=n(98537),tK=n.n(tG),t$=n(98621),tY=n.n(t$);function tW(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}var tQ=function(){return null},tJ=function(t){return Array.from(t.entries()).map(function(t){var e=(0,s.Z)(t,2);return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?tW(Object(n),!0).forEach(function(e){(0,H.Z)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tW(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({clientId:e[0]},e[1].user)})},tX=D.hj.create({name:"collaborationCursor",addOptions:function(){return{provider:null,user:{name:null,color:null},render:function(t){var e=document.createElement("span");if(!t.isReady)return e;e.classList.add("collaboration-cursor__caret"),e.setAttribute("style","border-color: ".concat(t.color));var n=document.createElement("div");n.classList.add("collaboration-cursor__label"),n.setAttribute("style","background-color: ".concat(t.color,"; color: ").concat(tY()(t.color).isDark()?"white":"black"));var o=t.name.split(" ")[0];return n.insertBefore(document.createTextNode(o),null),e.insertBefore(n,null),e},onUpdate:tQ}},addStorage:function(){return{users:[]}},addCommands:function(){var t=this;return{user:function(e){return function(){return t.options.user=tK()({},t.options.user,e),t.options.provider.awareness.setLocalStateField("user",t.options.user),!0}}}},addProseMirrorPlugins:function(){var t=this;return[(0,tF.JL)((t.options.provider.awareness.setLocalStateField("user",t.options.user),t.storage.users=tJ(t.options.provider.awareness.states),t.options.provider.awareness.on("update",function(){t.storage.users=tJ(t.options.provider.awareness.states)}),t.options.provider.awareness),{cursorBuilder:this.options.render})]}}),t0=n(17945),t1=D.hj.create({name:"globalDragHandle",priority:tq.a.GlobalDragHandle,addOptions:function(){return{scrollerSelector:"body"}},addStorage:function(){return{enabled:!0}},addProseMirrorPlugins:function(){return[(0,t0.f)({editor:this.editor,storage:this.storage,scrollerSelector:this.options.scrollerSelector})]},extendNodeSchema:function(t){var e;return{containerHandle:null!==(e=(0,D.nU)((0,D.Nl)(t,"containerHandle",t)))&&void 0!==e&&e}}}),t2=n(52347),t3=n(99703),t8=n(38815),t4=D.hj.create({name:"filmstrip",onCreate:function(){var t=q.Gk.getState(this.editor.state).undoManager;t.on("stack-item-popped",function(e){var n=t.undoStack,o=t.redoStack,r=e.stackItem.meta.get("filmstripState");if(r){var a=(0,t8.sy)((0,j.bh)().getState());"undo"===e.type&&o.length>0?o[o.length-1].meta.set("filmstripState",a):"redo"===e.type&&n.length>0&&n[n.length-1].meta.set("filmstripState",a),(0,j.bh)().dispatch((0,t8.tE)(r))}})}}),t7=n(82114),t5=n(80591),t9=n(89648),t6=n(74418),et=D.hj.create({name:"scrollMargin",addProseMirrorPlugins:function(){return[new C.Sy({props:{scrollMargin:t6.Sf,scrollThreshold:t6.Sf}})]}}),ee=n(11723),en=n(92397),eo=n(91718),er=n(95173),ea=n(94301),ei=n(11919),es=n(4036),ec=n(65903),eu=n.n(ec),el=n(59131),ed=n(52322),ef=function(t){var e=t.editor,n=(0,y.useState)(null),o=n[0],r=n[1];(0,y.useEffect)(function(){if(e){var t=function(){r(e.state.selection)};return t(),e.on("selectionUpdate",t),function(){e.off("selectionUpdate",t)}}},[e]);var a=o instanceof C.qv,i=o instanceof el.c,s=eu()((null==o?void 0:o.toJSON().type)||"none"),c=eu()(a&&(null==o?void 0:o.node.type.name)||""),u=i?void 0:a?"blue":"green";return(0,ed.jsx)(ea.h,{children:(0,ed.jsx)(ei.k,{className:"selection-debugger",position:"absolute",top:"50px",left:"10px",zIndex:"999999",children:(0,ed.jsxs)(d.K,{direction:"column",children:[(0,ed.jsxs)(es.C,{colorScheme:u,children:[s,c&&(0,ed.jsxs)("i",{children:[" (",c,")"]})]}),o&&(0,ed.jsxs)(es.C,{colorScheme:"gray",children:["f:",o.from," - t:",o.to,i&&" | side:".concat(o.side)]})]})})})},ep=n(37164),eh=n(43997),ev=n(71672),em=n(49392),ey=n(62141),eg=(0,ep.kP)("1234567890",10),eb=function(){var t=ev.Q.getItem(em.H.sessionId);if(t)return t;var e="".concat(+new Date,"__").concat(eg());return ev.Q.setItem(em.H.sessionId,e),e},ew=function(t,e){var n=(0,P.SE)(),o=n.user,r=n.isUserLoading,a=n.anonymousUser,i=n.color,s=(0,y.useRef)(!1),c=(0,eh.I0)(),u=(0,y.useMemo)(function(){return eb()},[]),l=(0,y.useMemo)(function(){return{id:(null==o?void 0:o.id)||a.id,color:i.value,sessionId:u,idleSince:null,name:(null==o?void 0:o.displayName)||a.displayName||"",profileImageUrl:(null==o?void 0:o.profileImageUrl)||"",isReady:!r,spotlight:{pos:null,cardId:null}}},[o,i,r,a,u]);(0,y.useEffect)(function(){if(t&&!t.isDestroyed&&e){t.commands.user(l),!s.current&&l.isReady&&(t.chain().blur().focusDelayed().run(),s.current=!0),c((0,ey.MU)({sessionId:l.sessionId}));var n=function(t,n){t.added,t.updated,t.removed,requestIdleCallback(function(){var t=tJ(e.awareness.states);c((0,ey.Tx)({collaborators:t}))},{timeout:500})};e.awareness.on("change",n);var o=F()(n,ey.Jp);return e.awareness.on("update",o),function(){e.awareness.off("change",n),e.awareness.off("update",o)}}},[l,t,e,c]),(0,y.useEffect)(function(){if(t){var e=F()(function(e){t.commands.user(e)},10);return(0,j.tC)(ey.gL,e)}},[t])},ek=n(68015),eS=n.n(ek),eA=function(t){var e=(0,y.useState)([]),n=e[0],o=e[1];return{logMessages:n,logPerfMessage:(0,y.useCallback)(function(e){if(t){var n=performance.now(),r={msg:e,timestamp:n};o(function(t){return 0===t.length?[].concat((0,tu.Z)(t),[r]):t.find(function(t){return t.msg===e})||t[t.length-1].msg===e?t:(r.duration=eS()(n-t[t.length-1].timestamp,2),[].concat((0,tu.Z)(t),[r]))})}},[t]),dumpLog:(0,y.useCallback)(function(){t&&o(function(t){try{console.table(t)}catch(t){}return[]})},[t])}},ex=n(21755),eP=n(81617),eM="custom",eD="updates",eC=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=eP.ay(t.db,[eD]),o=(0,s.Z)(n,1)[0];return eP.go(o,eP.sc(t._dbref,!1)).then(function(n){e(o),b.ay(t.doc,function(){n.forEach(function(e){return b.NG(t.doc,e)})},t,!1)}).then(function(){return eP.S_(o).then(function(e){t._dbref=e+1})}).then(function(){return eP.QX(o).then(function(e){t._dbsize=e})}).then(function(){return o})},eO=function(t){var e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return eC(t).then(function(n){(e||t._dbsize>=500)&&eP.yP(n,b.D$(t.doc)).then(function(){return eP.IV(n,eP.UE(t._dbref,!0))}).then(function(){return eP.QX(n).then(function(e){t._dbsize=e})})})},ej=function(t){(0,Q.Z)(o,t);var e,n=(e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,n=(0,X.Z)(o);if(e){var r=(0,X.Z)(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return(0,J.Z)(this,t)});function o(t,e){var r;return(0,$.Z)(this,o),(r=n.call(this)).doc=e,r.name=t,r._dbref=0,r._dbsize=0,r._destroyed=!1,r.db=null,r.synced=!1,r._db=eP.X3(t,function(t){return eP._w(t,[["updates",{autoIncrement:!0}],["custom"]])}),r.whenSynced=r._db.then(function(t){return r.db=t,eC((0,W.Z)(r),function(t){return eP.yP(t,b.D$(e))}).then(function(){return r._destroyed||(r.emit("synced",[(0,W.Z)(r)]),r.synced=!0),(0,W.Z)(r)})}),r._storeTimeout=1e3,r._storeTimeoutId=null,r._storeUpdate=function(t,e){if(r.db&&e!==(0,W.Z)(r)){var n=eP.ay(r.db,[eD]),o=(0,s.Z)(n,1)[0];eP.yP(o,t),++r._dbsize>=500&&(null!==r._storeTimeoutId&&clearTimeout(r._storeTimeoutId),r._storeTimeoutId=setTimeout(function(){eO((0,W.Z)(r),!1),r._storeTimeoutId=null},r._storeTimeout))}},e.on("update",r._storeUpdate),r.destroy=r.destroy.bind((0,W.Z)(r)),e.on("destroy",r.destroy),r}return(0,Y.Z)(o,[{key:"destroy",value:function(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(function(t){t.close()})}},{key:"clearData",value:function(){var t=this;return this.destroy().then(function(){eP.Lj(t.name)})}},{key:"get",value:function(t){return this._db.then(function(e){var n=eP.ay(e,[eM],"readonly"),o=(0,s.Z)(n,1)[0];return eP.U2(o,t)})}},{key:"set",value:function(t,e){return this._db.then(function(n){var o=eP.ay(n,[eM]),r=(0,s.Z)(o,1)[0];return eP.gz(r,e,t)})}},{key:"del",value:function(t){return this._db.then(function(e){var n=eP.ay(e,[eM]),o=(0,s.Z)(n,1)[0];return eP.IV(o,t)})}}]),o}(tt.y),eE=function(t,e,n){var o=new ej(t,e),r=F()(function(){var t=e.getMap("SCHEMA_VERSION").get("REQUIRED_VERSION");o.set("lastUpdated",new Date().toISOString()),o.set("schemaVersion",t||"")},1e3);return e.on("update",r),o.on("synced",function(){null==n||n()}),o},eI=n(56574),eR=n(93665),e_=n(55452),eT=n(40110),eZ=n(55479),ez=n(49929),eB=n(8388),eL=n(32333),eU=n(21819),eN=n(20406),eH=n(28526),eq=n.n(eH);n(18149);var eV=(o=(0,eN.Z)(eq().mark(function t(e,n,o,r){var a,i,s,c,u;return eq().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i=(a=o||{}).id,s=a.length,t.next=4,fetch("".concat(w.v.MULTIPLAYER_WS_URL.replace("wss","https"),"/").concat(e,"/verify/").concat(n),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:i,length:s,clientCount:null==r?void 0:r.clientCount,totalCount:null==r?void 0:r.totalCount})});case 4:return c=t.sent,t.next=7,c.json();case 7:return u=t.sent,t.abrupt("return",u);case 11:t.prev=11,t.t0=t.catch(0);case 13:return t.abrupt("return");case 14:case"end":return t.stop()}},t,null,[[0,11]])})),function(t,e,n,r){return o.apply(this,arguments)}),eF=function(t){var e=t.document.store.clients.get(t.document.clientID);if(e&&e.length)return e[e.length-1]},eG=(r=(0,eN.Z)(eq().mark(function t(e,n,o){var r,a,i,s,c,u,l;return eq().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=eF(n),a={clientCount:n.document.store.clients.size,totalCount:(0,tu.Z)(n.document.store.clients.values()).reduce(function(t,e){return t+e.reduce(function(t,e){return t+e.length},0)},0)},t.next=4,eV(e.gammaDocId,n.document.clientID,r,a);case 4:if(i=t.sent){t.next=8;break}return console.warn("[compareClocks] Failed to fetch remote clock"),t.abrupt("return",!1);case 8:return t.prev=8,(c=((null==r?void 0:r.id.clock)||0)+((null==r?void 0:r.length)||0)-(((null==i?void 0:null===(s=i.lastKnownItem.id)||void 0===s?void 0:s.clock)||0)+((null==i?void 0:i.lastKnownItem.length)||0)))>0&&console.warn("[compareClocks] Clock drift detected",{diffLastItem:c}),u=a.clientCount-(i.itemSummary.clientCount||0),l=a.totalCount-(i.itemSummary.totalCount||0),u>0&&console.warn("[compareClocks] clientCount drift detected",{diffClientCount:u}),l>0&&console.warn("[compareClocks] totalCount drift detected",{diffTotalCount:l}),t.abrupt("return",0===u&&l<=o&&c<=o);case 20:t.prev=20,t.t0=t.catch(8),console.warn("[compareClocks] Failed to fetch remote clock");case 23:return t.abrupt("return",!1);case 24:case"end":return t.stop()}},t,null,[[8,20]])})),function(t,e,n){return r.apply(this,arguments)}),eK=function(t){var e=t.editor,n=t.yProvider,o=t.enabled,r=t.pollingInterval,a=(0,y.useState)(Date.now()),i=a[0],s=a[1],c=(0,y.useState)(0),u=c[0],l=c[1],d=(0,y.useState)(0),f=d[0],p=d[1],h=(0,K.ye)("dataSyncClockDriftTolerance");return(0,y.useEffect)(function(){if(e&&n&&o){var t,a,i=!0,c=(t=(0,eN.Z)(eq().mark(function t(){var o;return eq().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.gammaDocId){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,eG(e,n,h);case 4:(o=t.sent)?s(Date.now()):console.warn("[useDataPersistenceSync_2] Clocks out of sync for doc",e.gammaDocId),requestIdleCallback(function(){l(function(t){return o?0:t+1}),p(function(t){return 0}),i&&(a=window.setTimeout(c,r))});case 7:case"end":return t.stop()}},t)})),function(){return t.apply(this,arguments)});return c(),function(){clearTimeout(a),i=!1}}},[e,n,o,r,h]),{errorCountClock:u,errorCountPMState:f,yDocLastSynced:i}},e$=/^[\t\n -\}]$/,eY=function(t){var e=t.editor,n=t.pollingInterval,o=(0,y.useRef)(Date.now()),r=(0,y.useRef)(Date.now()),a=(0,y.useState)(0),i=a[0],s=a[1];return(0,y.useEffect)(function(){if(e){var t=function(t){!t.metaKey&&t.key.match(e$)&&(o.current=Date.now())},a=function(t){t.transaction.docChanged&&(o.current=Date.now(),r.current=Date.now())};e.on("update",a),e.view.dom.addEventListener("keydown",t,!0);var i=setInterval(function(){r.current-o.current>500?(console.error("[useDataPersistenceSync_0] Delay to capture changes has exceeded threshold"),s(function(t){return t+1})):s(0)},n);return function(){clearInterval(i),e.off("update",a),e.view.dom.removeEventListener("keydown",t,!0)}}},[e,n]),i};function eW(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)}return n}function eQ(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?eW(Object(n),!0).forEach(function(e){(0,H.Z)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):eW(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var eJ="data-sync-error-toast",eX=(0,ed.jsx)(ez.G,{icon:eR.xH,size:"2x"}),e0=(0,ed.jsx)(ez.G,{icon:eI.ik,size:"2x"}),e1=function(t){var e=t.type,n=t.yDocLastSynced;return function(){return(0,ed.jsx)(ei.k,{direction:"column",p:4,color:"white",bg:"warn"===e?"yellow.500":"red.500",borderRadius:"md",children:(0,ed.jsxs)(ei.k,{alignItems:"center",children:["warn"===e?eX:e0,(0,ed.jsxs)(u.xu,{ml:3,children:[(0,ed.jsx)(p.x,{lineHeight:6,fontSize:"sm",fontWeight:"bold",children:"warn"===e?(0,ed.jsx)(e_.cC,{id:"IkN23t"}):(0,ed.jsx)(e_.cC,{id:"kXEHsK"})}),n&&(0,ed.jsx)(p.x,{lineHeight:6,fontSize:"sm",children:(0,ed.jsx)(e_.cC,{id:"VxWwaW",values:{0:(0,eB.Dw)(new Date(n).toISOString())}})}),"error"===e&&(0,ed.jsxs)(ed.Fragment,{children:[(0,ed.jsx)(eT.i,{pt:2}),(0,ed.jsx)(p.x,{lineHeight:6,fontSize:"sm",pt:2,children:(0,ed.jsx)(e_.cC,{id:"Pw5K5r"})})]})]})]})})}},e2=function(t){var e=t.editor,n=t.yProvider,o=t.enabled,r=(0,j.CG)(ey.Tf),a=(0,eU.Br)("comment"),i=(0,j.CG)(ey.q7),s=(0,y.useState)(2e4),c=s[0],u=s[1],l=(0,eL.z$)(),d=(0,eZ.p)(),f=(0,P.SE)().user,p=(0,y.useRef)(),h=(0,K.ye)("dataSyncErrorThreshold"),v=eY({editor:e,pollingInterval:c}),m=eK({editor:e,yProvider:n,enabled:o&&a,pollingInterval:c}),g=m.errorCountPMState,b=m.errorCountClock,w=m.yDocLastSynced,k={docSavedTime:i,yDocLastSynced:w,errorCountKeyboard:v,errorCountPMState:g,errorCountClock:b,clientID:null==n?void 0:n.document.clientID,userId:null==f?void 0:f.id},S=(0,y.useRef)(k);S.current=k;var A=b+g;(0,y.useEffect)(function(){u(0===A?2e4:4e3)},[A]);var x=o&&-1!==h&&A>h,M=o&&-1!==h&&A/h>2;return(0,y.useEffect)(function(){if(!x||r){if(d.isActive(eJ)){d.close(eJ);var t=p.current?+new Date-+p.current:void 0;null==l||l.trackDocEvent(eL.xW.DATA_SYNC_RECOVER,eQ(eQ({},S.current),{},{duration:t})),p.current=void 0}return}var n=e1({type:M?"error":"warn",yDocLastSynced:w});d.isActive(eJ)?d.update(eJ,{render:n}):(null==l||l.trackDocEvent(eL.xW.DATA_SYNC_ERROR,S.current),p.current=new Date,d({render:n,duration:null,id:eJ})),M&&console.error("[useDataPersistenceSync] ERROR_THRESHOLD_EXCEEDED. docId:",null==e?void 0:e.gammaDocId)},[e,d,l,M,x,i,w,r]),M},e3=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=(0,y.useRef)(0),o=(0,y.useRef)(0),r=(0,y.useState)(!1),a=r[0],i=r[1],s=(0,y.useState)(0),c=s[0],u=s[1],l=(0,y.useState)(document.hidden),d=l[0],f=l[1],p=(0,y.useRef)(function(){if(n.current++,n.current>=e&&(console.warn("[useRateLimiter] Limit hit! (".concat(e," per ").concat(t/1e3,"s)")),a||(i(!0),u(function(t){return t+1}))),!o.current){var r=t/e;o.current=g.Zi(function(){n.current>0?n.current--:(i(!1),g.cv(o.current),o.current=0)},r)}});return(0,y.useEffect)(function(){var t=function(){f(document.hidden),p.current()};return document.addEventListener("visibilitychange",t),function(){return document.removeEventListener("visibilitychange",t)}},[]),[p.current,a,c,d]},e8=n(94659),e4=n(45650),e7=function(){return(0,ed.jsxs)(e8.g,{align:"flex-end",borderRadius:"base",shadow:"lg",p:3,bg:"gray.100",spacing:4,maxW:"300px",direction:"row",children:[(0,ed.jsxs)(u.xu,{children:[(0,ed.jsx)(p.x,{fontSize:"md",fontWeight:"bold",children:(0,ed.jsx)(e_.cC,{id:"oSUMyx"})}),(0,ed.jsxs)(p.x,{fontSize:"sm",children:[(0,ed.jsx)(e_.cC,{id:"CDva2g"})," ",(0,ed.jsx)("em",{children:(0,ed.jsx)(e_.cC,{id:"/vuJlA"})})," ","\uD83D\uDE0E"]})]}),(0,ed.jsx)(u.xu,{children:(0,ed.jsx)(e4.z,{size:"sm",onClick:function(){window.location.reload()},children:(0,ed.jsx)(e_.cC,{id:"HpK/8d"})})})]})},e5=function(t){var e=(0,eZ.p)(),n=(0,y.useState)(!1),o=n[0],r=n[1];return(0,y.useEffect)(function(){if(t){var e=function(){var e=t.getMap("SCHEMA_VERSION").get("REQUIRED_VERSION"),n=!!(e&&e>er.bI);r(n),console[n?"warn":"debug"]("[SchemaVerifier] onUpdate",{requiredVersion:e,MY_VERSION:er.bI,outdated:n})};return t.on("update",e),function(){t.off("update",e)}}},[t]),(0,y.useEffect)(function(){o&&!e.isActive("schema_outdated")&&e({id:"schema_outdated",duration:null,status:"warning",isClosable:!1,position:"bottom-left",render:e7})},[o,e]),o},e9=function(){return{SCHEMA_VERSION:String(er.bI),SHARE_TOKEN:w.v.SHARE_TOKEN}},e6=(0,y.memo)(function(t){var e=t.doc,n=t.docId,o=t.onCreate,r=t.readOnly,a=void 0!==r&&r,i=t.scrollingParentSelector,D=t.hideForPreview,C=(0,A.bf)(),O=C.timeOnCreate,j=C.timeOnSetupProvider,E=C.timeOnDownloadDoc,I=(0,y.useState)("connecting"),R=I[0],_=I[1],Z=(0,y.useState)(!1),L=Z[0],U=Z[1],H=(0,y.useRef)(!1);H.current=L;var q=(0,y.useState)(!1),V=q[0],F=q[1],G=(0,y.useState)(!1),K=G[0],$=G[1],Y=(0,y.useRef)([]),W=(0,y.useState)(),Q=W[0],J=W[1],X=(0,y.useState)(),tt=X[0],te=X[1],tn=(0,y.useState)(),to=tn[0],tr=tn[1],ta=(0,y.useState)(),ti=ta[0],ts=ta[1],tc=e5(tt);ew(Q,to),(0,eo.jB)(Q);var tu=e3(),tl=(0,s.Z)(tu,4),td=tl[0],tf=tl[1],tp=tl[2],th=tl[3],tv=e&&e.organization&&e.organization.id,tm=(0,k.$gs)(),ty=tm.isConnected,tg=tm.setHocuspocusConnected,tb=e2({editor:Q,yProvider:to,enabled:ty&&!th&&!a}),tw=(0,S.y)("debugLogging"),tk=(0,S.y)("debugCardViewed"),tS=(0,S.y)("offline"),tA=eA(tw),tx=tA.logMessages,tP=tA.logPerfMessage,tM=tA.dumpLog;(0,y.useEffect)(function(){tS&&to&&!ti&&ts(eE(n,to.document,function(){"number"==typeof to.document.getMap("SCHEMA_VERSION").get("REQUIRED_VERSION")&&(U(!0),F(!0))}))},[tS,to,n,ti]),(0,P.$K)((0,y.useCallback)(function(){to&&(to.disconnect(),to.configuration.parameters=e9(),setTimeout(function(){return to.connect()},500))},[to])),(0,ex.n)(Q),(0,y.useEffect)(function(){tg(H.current||"connected"===R||th)},[tg,R,th]),(0,c.z)(function(){return tg(null)},[]),(0,y.useEffect)(function(){to&&H.current&&"connected"===R&&(console.debug("[CollaborativeEditor] Force syncing on reconnect."),to.forceSync())},[to,R]),(0,y.useEffect)(function(){if(to){var t,e=tp>10;if(tf){console.warn("[CollaborativeEditor] Attempted to re-connect while rate limited (".concat(tp," of ").concat(10,").")),to.disconnect();return}if(e){console.error("[CollaborativeEditor - RECONNECT_RATE_LIMIT] Max rate limit violations reached (".concat(10,"). Will reload.")),setTimeout(function(){window.location.reload()},500);return}if(L)return th?(console.debug("[CollaborativeEditor] Backgrounded, will wait ".concat(12e4,"s before disconnect")),t=g.iK(function(){console.debug("[CollaborativeEditor] Disconnecting after grace period"),to.disconnect()},12e4)):(console.debug("[CollaborativeEditor] Foregrounded, so re-connecting"),to.connect()),function(){t&&g.gr(t)}}},[to,L,th,tf,tp]),(0,y.useEffect)(function(){Q&&!Q.isDestroyed&&tv&&Q.commands.setOrgId(tv)},[Q,tv]),(0,y.useEffect)(function(){console.debug("[CollaborativeEditor] Creating yProvider for doc",n);var t=new b.QW({});te(t),t.on("update",function(e){t.getMap("GammaPersistenceMeta").get("READY")&&(tP("Document data downloaded"),$(!0))}),tP("Setting up hocuspocus"),j();var e=new v.Ui({url:w.v.MULTIPLAYER_WS_URL,name:n,document:t,forceSyncInterval:15e3,maxAttempts:25,parameters:e9(),onStatus:function(t){var e=t.status;console.debug("[CollaborativeEditor][onStatus]",{status:e}),_(e),"connected"===e?(tP("Hocuspocus connected"),U(!0)):"connecting"===e&&(tP("Hocuspocus connecting"),td())},onSynced:function(){console.debug("[CollaborativeEditor] Provider synced"),F(!0)},onDisconnect:function(t){var e=t.event;console.debug("[CollaborativeEditor][onDisconnect]",{event:e}),e.code===h.NI.code&&console.error('[CollaborativeEditor] Provider disconnected with "Unauthorized.code", which is unexpected.',e)}});return tr(e),w.v.DEBUG_ENABLED&&(window.gammaEditorProvider=e),Y.current=[t7.zL,et,eo.$1.configure({scrollerSelector:i}),tV.configure({document:t}),T.configure({provider:e}),tX.configure({provider:e}),tE.configure({document:t}),tz,tL,tR.configure(),tU.NM,en.W,z.configure({document:t}),N,t9.L,t2.Pi,t5.R,t3._g,ee.Jn,m.ZT.configure({openDoubleQuote:!1,closeDoubleQuote:!1,openSingleQuote:!1,closeSingleQuote:!1}),t1.configure({scrollerSelector:i}),B.F,t4,x.p.configure({document:t})],function(){console.warn("[CollaborativeEditor] Destroying yProvider for doc ➡️",n),e.disconnect(),e.destroy(),delete window.gammaEditorProvider,tr(void 0),F(!1),U(!1),$(!1),setTimeout(function(){if(e&&e.awareness)try{e.awareness.destroy()}catch(t){console.warn("[CollaborativeEditor] Error destroying awareness provider.")}})}},[n,tP,td,i,j]);var tD=!!(L&&V&&K);(0,y.useEffect)(function(){tD&&(tP("Is ready for TipTap"),E())},[tD,E,tP]);var tC=!tS&&(!ty||tb);return(0,ed.jsxs)(u.xu,{display:void 0!==D&&D?"none":"block",w:"100%","data-testid":"collaborative-editor-wrapper",children:[tD&&tk&&(0,ed.jsx)(ef,{editor:Q}),!Q&&(0,ed.jsx)(u.xu,{flexDirection:"column",flex:"1",w:"100%",h:"var(--100vh)",bg:"gray.100",zIndex:"overlay","data-testid":"collaborative-editor-skeleton",mt:1,inset:0,children:(0,ed.jsx)(l.M,{h:"100%",children:(0,ed.jsxs)(d.K,{align:"center",children:[(0,ed.jsx)(f.$,{}),tx.map(function(t,e){var n=t.msg;return(0,ed.jsx)(p.x,{children:n},e)})]})})}),tD&&(0,ed.jsx)(M.y,{extensions:Y.current,doc:e,docId:n,editorId:"main",onCreate:function(t){var e=t.editor;setTimeout(function(){J(e),o&&o(e),requestAnimationFrame(function(){tP("Editor rendered"),O(),tM()})},10)},readOnly:tc||a||tC,shouldSupportComments:!0,shouldSupportMenus:!0,scrollingParentSelector:i})]})}),nt=n(86297),ne=n(87880)},95173:function(t,e,n){n.d(e,{bI:function(){return r}}),n(36738);var o=new URLSearchParams(window.location.search),r=(o.get("SCHEMA_VERSION")?Number(o.get("SCHEMA_VERSION")):null)||85}}]);
//# sourceMappingURL=8163-30433268e82fcf49.js.map