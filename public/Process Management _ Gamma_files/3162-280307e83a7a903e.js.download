"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3162],{97782:function(e,t,n){n.d(t,{T:function(){return p}});var r=n(20406),o=n(28526),a=n.n(o),i=n(2784),s=n(23313),c=n(46358),u=n(96368),d=n(62141),l=n(46732),p=function(){var e,t=(0,l._)().editor,n=null==t?void 0:t.gammaDocId,o=(0,u.vi)({docId:n,editor:t}).updateDocThemeWithAccentImages,p=(0,c.CG)(d.F_),f=(0,i.useCallback)(function(e){return p===e},[p]),g=(0,s.WQq)();return{setThemeWithAccentImages:o,isThemeApplied:f,currentThemeId:p,isValidTheme:(0,i.useCallback)((e=(0,r.Z)(a().mark(function e(t){var n;return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.query({query:s.vGj,variables:{id:t},returnPartialData:!1});case 3:return n=e.sent.data,e.abrupt("return",(null==n?void 0:n.theme)!==null);case 8:return e.prev=8,e.t0=e.catch(0),console.warn("[useThemeModificationController.isValidTheme] Error checking if theme is valid",e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,null,[[0,8]])})),function(t){return e.apply(this,arguments)}),[g])}}},73062:function(e,t,n){n.d(t,{n:function(){return r}});var r=function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.overflow="scroll",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);var t=document.createElement("div");e.appendChild(t);var n=e.offsetWidth-t.offsetWidth;return e.parentNode.removeChild(e),n}},91465:function(e,t,n){n.d(t,{m:function(){return I},n:function(){return j}});var r=n(20406),o=n(95235),a=n(82269),i=n(28526),s=n.n(i),c=n(53738),u=n(2784),d=n(43997),l=n(70204),p=n(47592),f=n(79073),g=n(66843),m=n(62141),h=n(38028),y=n(13121),v=n(19700),b=n(82477),x=n(52322),k=["reduxData"];function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var I=function(e){var t=e.reduxData,n=(0,a.Z)(e,k),r=(0,v.c)(t);return(0,x.jsx)(d.zt,{store:r,children:(0,x.jsx)(C,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach(function(t){(0,o.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},n))})},C=function(e){var t=e.onCreate,n=void 0===t?function(){}:t,o=e.initialContent,a=e.content,i=e.theme,v=e.isThumbnail,k=e.portalComponent,w=(0,u.useState)(!1),I=w[0],C=w[1],j=(0,u.useMemo)(function(){return(0,b.e)()},[]),O=(0,d.I0)();(0,u.useEffect)(function(){O((0,m.Dc)({theme:i||null})),O((0,m.iS)({isAllowedToEdit:!1})),O((0,m.Nr)({animationsEnabled:!1}))},[i,O]);var R=(0,y.jE)({onCreate:function(e){return(0,r.Z)(s().mark(function t(){var r,o;return s().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o=e.editor,console.debug("[EditorPreview][onCreate] TipTap editor is now ready"),null===(r=f.Z8.getState(o.state))||void 0===r||r.compute(o.state).processChanges(O),o.commands.command(function(){return(0,p.E0)(o.state.doc,O),!0}),C(!0),null==n||n({editor:o});case 6:case"end":return t.stop()}},t)}))()},extensions:j,content:void 0===o?void 0:o,editable:!1});return(R.isThumbnail=v,(0,u.useEffect)(function(){var e;a&&R&&(R.commands.setContent(a),R.commands.command(function(){return(0,p.E0)(R.state.doc,O),!0}),null===(e=g.S.getState(R.state))||void 0===e||e.compute(R.state.doc).processChanges(O))},[a,R,O]),(0,l.p)([],R),I)?(0,x.jsx)(c.xu,{className:"editor-preview-root","data-variation-preview":!0,"data-testid":"editor-preview-root",width:"100%",position:"relative",sx:h.I,children:(0,x.jsx)(y.kg,{editor:R,portalComponent:k,style:{width:"100%",height:"100%"},className:"highlight-mask"})}):(0,x.jsx)(x.Fragment,{})},j={"[data-thumbnail-hidden]":{display:"none !important"},"*":{backdropFilter:"none !important",webkitBackdropFilter:"none !important","-webkit-transition":"none !important","-moz-transition":"none !important","-o-transition":"none !important","-ms-transition":"none !important",transition:"none !important"},contain:"paint",".editor-core-root, .editor-preview-root":{height:"100% !important",width:"auto !important"},".doc-content-wrapper":{pb:"0 !important",minH:"auto !important"},"[data-doc-background-element], [data-doc-background-element-present-mode]":{display:"none !important"},".card2-background":{mt:0}}},76949:function(e,t,n){n.d(t,{xg:function(){return eC},rN:function(){return ew},r8:function(){return ek}});var r=n(11919),o=n(71354),a=n(25925),i=n(2784),s=n(95498),c=n(95235),u=n(55452),d=n(91012),l=n(45650),p=n(5766),f=n(36895),g=n(46358),m=n(16975),h=n(70548),y=n(27563),v=n(88299),b=n(20280),x=n(30628),k=n(87254),w=n(55479),I=n(8283),C=n(93319),j=n(76648),O=n(67887),R=n(49747),S=n(25793),E=n(49929),T=n(55966),M=n(32333),A=n(52322),P=(0,i.memo)(function(e){var t=e.message,n=(0,w.p)(),r=(0,M.z$)(),a=ek().scrollToBottom,s=(0,i.useRef)(null),c=(0,i.useState)(!1),d=c[0],p=c[1],f=(0,i.useState)(null),g=f[0],m=f[1];(0,i.useEffect)(function(){if(d){var e;null===(e=s.current)||void 0===e||e.focus(),null==a||a()}},[d,a,r]);var h=t.interactionId,y=t.type,v=(0,i.useCallback)(function(e){m(e),p(!0),null==r||r.track(M.AA.AI_SUGGESTION_FEEDBACK,{interactionId:h,rating:e,type:y})},[r,h,y]),P=(0,i.useCallback)(function(){var e;p(!1),null==r||r.track(M.AA.AI_SUGGESTION_FEEDBACK,{interactionId:h,rating:g,type:y,feedback:null===(e=s.current)||void 0===e?void 0:e.value}),s.current&&(s.current.value=""),n({title:(0,A.jsx)(u.cC,{id:"d6N994"}),description:(0,A.jsx)(u.cC,{id:"s/fQ3s"}),status:"success",duration:5e3,isClosable:!0})},[n,r,h,g,y]);return(0,A.jsxs)(o.K,{width:"100%",children:[(0,A.jsxs)(I.U,{children:[(0,A.jsx)(C.L,{}),(0,A.jsxs)(j.h,{size:"xs",variant:"ghost",colorScheme:"blackAlpha",children:[(0,A.jsx)(T.kH,{label:(0,A.jsx)(u.cC,{id:"kR82DG"}),placement:"top",children:(0,A.jsx)(O.h,{"aria-label":"thumbs down",color:"poor"===g?"red.600":void 0,borderWidth:"1px",borderColor:"poor"===g?"red.600":"transparent",bg:"poor"===g?"red.100":void 0,_hover:{bg:"poor"===g?"red.200":"blackAlpha.100"},icon:(0,A.jsx)(E.G,{icon:x.b}),onClick:function(){v("poor")}})}),(0,A.jsx)(T.kH,{label:(0,A.jsx)(u.cC,{id:"y1GvbS"}),placement:"top",children:(0,A.jsx)(O.h,{"aria-label":"thumbs up",color:"good"===g?"green.600":void 0,borderWidth:"1px",borderColor:"good"===g?"green.600":"transparent",bg:"good"===g?"green.100":void 0,_hover:{bg:"good"===g?"green.200":"blackAlpha.100"},icon:(0,A.jsx)(E.G,{icon:b.u8}),onClick:function(){v("good")}})})]})]}),(0,A.jsx)(R.U,{in:d,children:(0,A.jsxs)(o.K,{children:[(0,A.jsx)(S.g,{ref:s,bg:"white",size:"sm",placeholder:k.ag._({id:"ZVGh9y"})}),(0,A.jsxs)(j.h,{children:[(0,A.jsx)(C.L,{}),(0,A.jsx)(l.z,{onClick:function(){return p(!1)},size:"xs",variant:"ghost",colorScheme:"blackAlpha",children:(0,A.jsx)(u.cC,{id:"6Uau97"})}),(0,A.jsx)(l.z,{onClick:P,size:"xs",variant:"plain",children:(0,A.jsx)(u.cC,{id:"RoafuO"})})]})]})})]})});function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}P.displayName="SuggestionFeedback";var D=(0,i.memo)(function(e){var t=e.message,n=e.editor,r=t.suggestions.slice(0,1),a=(0,g.TL)(),s=(0,g.qr)(),b=(0,i.useCallback)(function(){return(0,h.AZ)(s.getState())},[s]),x=(0,i.useCallback)(function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach(function(t){(0,c.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({timestamp:Date.now()},e);a((0,h.Hz)({message:t}))},[a]),k=(0,y.n)({addMessage:x,getMessageHistory:b,editor:n}).sendMessage;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(v.K,{children:(0,A.jsxs)(o.K,{align:"start",children:[(0,A.jsx)(d.x,{children:(0,A.jsx)(u.cC,{id:"A9MA7Q",components:{0:(0,A.jsx)(l.z,{variant:"link",onClick:function(){k({message:t.message||""})}})}})}),(0,A.jsx)(d.x,{color:"gray.500",textAlign:"center",fontSize:"xs",children:(0,A.jsx)(u.cC,{id:"ygs5tU"})}),(0,A.jsx)(p.M,{columns:2,spacing:2,w:"100%",children:r.map(function(e){return(0,A.jsx)(f.E,{src:e.attrs.src,onDragStart:function(){n&&(0,m.UV)(n,{type:"image",attrs:e.attrs})},h:36,draggable:!0,w:"100%",borderRadius:"md",transitionDuration:"normal",transitionProperty:"common",objectFit:"cover",cursor:"grab",_hover:{shadow:"outline"}},e.attrs.src)})}),(0,A.jsx)(P,{message:t})]})}),t.isFirstGenerationInSession&&(0,A.jsx)(v.K,{children:(0,A.jsx)(d.x,{children:(0,A.jsx)(u.cC,{id:"VraWhP"})})})]})});D.displayName="GenerateImage";var _=n(3915),N=n(45393),F=n.n(N),L=n(94659),q=function(e){var t=e.sendMessage,n=(0,i.useState)(F()([k.ag._({id:"91gjMr"}),k.ag._({id:"PHyjBQ"}),k.ag._({id:"zhFV/H"}),k.ag._({id:"4ReFRy"}),k.ag._({id:"aepNQh"}),k.ag._({id:"fr8euV"}),k.ag._({id:"+TEOEl"}),k.ag._({id:"gQIRQv"}),k.ag._({id:"pbDMHv"}),k.ag._({id:"LP7cSD"}),k.ag._({id:"ugneAh"})],4).concat(F()([k.ag._({id:"DZ/eyq"}),k.ag._({id:"S2U0+k"}),k.ag._({id:"YZJ7kT"}),k.ag._({id:"fLq3m1"}),k.ag._({id:"1nrH2R"})],2)))[0];return(0,A.jsx)(L.g,{spacing:2,align:"flex-start",children:n.map(function(e,n){return(0,A.jsx)(l.z,{variant:"unstyled",bg:"white",borderRadius:"md",size:"sm",px:2,border:"1px solid",borderColor:"gray.200",color:"orchid.400",fontWeight:"500",_hover:{bg:"trueblue.50",color:"trueblue.700"},onClick:function(){t(e)},children:e},n)})})},G=function(e){var t,n=e.sendMessage,r=e.hideSuggestions,o=(0,_.SE)().user;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(v.K,{from:"Designer",children:(t=null==o?void 0:o.firstName,{from:"Designer",type:"text",message:k.ag._({id:"q65R55",values:{userName:t}}),timestamp:Date.now()}).message}),!(void 0!==r&&r)&&(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(d.x,{color:"gray.500",fontSize:"sm",children:(0,A.jsx)(u.cC,{id:"MVir6z"})}),(0,A.jsx)(q,{sendMessage:n})]})]})},H=n(10676),U=n(13813),z=n(40110),B=n(53738),K=n(15110),V=n(97782),W=n(91465),$=n(62141),Y=n(24272),J=n(54073),Q=n.n(J);function X(e,t,n){var r;return null!==(r=n.find(function(n){return n.modification.isApplied(e,t)}))&&void 0!==r?r:null}function ee(e,t){var n=(0,g.CG)($.Pu),r=(0,V.T)(),o=(0,i.useState)(function(){return e?X(e,r,t):null}),a=o[0],s=o[1],c=(0,i.useCallback)(function(){e&&s(X(e,r,t))},[e,t,r]);return(0,i.useEffect)(function(){if(e){var n=Q()(function(){s(X(e,r,t))},1e3);return e.on("update",n),function(){e.off("update",n)}}},[e,t,r]),(0,i.useEffect)(function(){c()},[c,n]),{activeSuggestion:a,forceUpdate:c}}var et=(0,i.memo)(function(e){var t=e.message,n=e.editor,r=(0,Y.E)(),a=(0,V.T)(),s=ee(n,t.suggestions),c=s.activeSuggestion,u=s.forceUpdate,l=(0,i.useCallback)(function(e){n&&(r.trackSuggestionApplied({interactionId:t.interactionId,suggestionType:e.type,suggestionLabel:e.description,suggestionContent:e.getContentForTracking()}),e.apply(n,a),u())},[n,u,t.interactionId,a,r]);return n?(0,A.jsx)(v.K,{children:(0,A.jsxs)(o.K,{divider:(0,A.jsx)(z.i,{borderColor:"blackAlpha.200"}),children:[(0,A.jsx)(d.x,{children:t.message||"How's this?"}),t.suggestions.map(function(e,t){return(0,A.jsx)(en,{isSelected:e.label===(null==c?void 0:c.label),jsonContentPreview:e.jsonContentPreview,label:e.label,modification:e.modification,onClick:function(){l(e.modification)}},t)}),(0,A.jsx)(P,{message:t})]})}):null});et.displayName="SuggestContent";var en=function(e){var t=e.label,n=e.modification,o=e.jsonContentPreview,a=e.isSelected,s=e.onClick,c=(0,g.CG)($.Pu);console.debug("[".concat(t,"] jsonContentPreview"),o,n);var u=(0,i.useCallback)(function(){a||s()},[a,s]);return(0,A.jsxs)(I.U,{onClick:u,cursor:"pointer",px:2,py:1,borderRadius:"xl",_hover:{bg:"blackAlpha.100"},bg:a?"whiteAlpha.600":void 0,transitionProperty:"common",transitionDuration:"normal",spacing:4,children:[o&&(0,A.jsx)(r.k,{sx:{"mask-image":"linear-gradient(to bottom, black 75%, transparent 100%)"},children:(0,A.jsx)(r.k,{sx:W.n,justifyContent:"center",alignItems:"top",width:"150px",h:16,children:(0,A.jsx)(B.xu,{transformOrigin:"top",transform:"scale(0.15)",pointerEvents:"none",children:(0,A.jsx)(W.m,{content:o,theme:c})})})}),(0,A.jsx)(d.x,{flex:1,fontSize:"sm",children:t}),(0,A.jsx)(K.M,{in:a,children:(0,A.jsx)(E.G,{icon:U.LE,fixedWidth:!0})})]})},er=n(75652),eo=n.n(er),ea=n(73805),ei=n(31889),es=(0,i.memo)(function(e){var t=e.message,n=e.editor,r=t.suggestions.slice(0,8),a=eo()(r.map(function(e){return e.query})),i=0===a.length?k.ag._({id:"QICyFn"}):1==a.length?k.ag._({id:"x/YBq7",values:{0:a[0].toLowerCase()}}):2==a.length?k.ag._({id:"Tn1hkb",values:{0:a[0].toLowerCase(),1:a[1].toLowerCase()}}):k.ag._({id:"Z918ro",values:{0:a[0].toLowerCase(),1:a[1].toLowerCase(),2:a[2].toLowerCase()}});return(0,A.jsx)(v.K,{children:(0,A.jsxs)(o.K,{align:"start",children:[(0,A.jsxs)(d.x,{children:[i," ",(0,A.jsx)(u.cC,{id:"CvUN7V"})]}),(0,A.jsx)(d.x,{color:"gray.500",textAlign:"center",fontSize:"xs",children:(0,A.jsx)(u.cC,{id:"fg3FfA"})}),(0,A.jsx)(p.M,{columns:2,spacing:2,w:"100%",children:r.map(function(e){var t=e.image,r=e.query,o=e.provider,a=(0,ei.SN)(t.thumbnailUrl,{width:250,height:250});return(0,A.jsx)(f.E,{src:a,fallbackSrc:t.thumbnailUrl,onDragStart:function(){n&&(0,m.UV)(n,{type:"image",attrs:(0,ea.C)(t,r,o)})},h:24,draggable:!0,w:"100%",borderRadius:"md",transitionDuration:"normal",transitionProperty:"common",objectFit:"cover",cursor:"grab",_hover:{shadow:"outline"}},t.id)})}),(0,A.jsx)(P,{message:t})]})})});es.displayName="SuggestImage";var ec=(0,i.memo)(function(e){var t=e.message,n=e.editor,r=(0,Y.E)(),o=(0,V.T)(),a=ee(n,t.suggestions),i=a.activeSuggestion,s=a.forceUpdate;return(0,A.jsx)(v.K,{from:t.from,children:(0,A.jsxs)(L.g,{spacing:2,align:"start",children:[(0,A.jsx)(d.x,{children:t.message||"Here are some ideas:"}),t.suggestions.map(function(e,a){return(0,A.jsx)(eu,{value:e,isSelected:e===i,onClick:function(){if(n){var a=e.modification;r.trackSuggestionApplied({interactionId:t.interactionId,suggestionType:a.type,suggestionLabel:a.description,suggestionContent:a.getContentForTracking()}),a.apply(n,o),s()}}},a)}),(0,A.jsx)(P,{message:t})]})})}),eu=function(e){var t=e.value,n=e.isSelected,r=e.onClick,o=(0,i.useCallback)(function(){n||r()},[n,r]);return(0,A.jsxs)(I.U,{onClick:o,cursor:"pointer",p:4,borderRadius:"xl",_hover:{bg:"whiteAlpha.600"},bg:"white",transitionProperty:"common",transitionDuration:"normal",spacing:4,shadow:"md",align:"start",children:[(0,A.jsxs)(B.xu,{children:[(0,A.jsx)(d.x,{fontSize:"sm",color:"gray.500",children:t.reason}),(0,A.jsx)(d.x,{fontSize:"sm",noOfLines:3,children:t.value.replace(/(<([^>]+)>)/gi,"")})]}),(0,A.jsx)(K.M,{in:n,children:(0,A.jsx)(E.G,{icon:U.LE,fixedWidth:!0})})]})};ec.displayName="SuggestText";var ed=n(18504),el=n(21496),ep=n(96368),ef=n(6985),eg=(0,i.memo)(function(e){var t=e.message,n=e.editor,r=ek().onClose,a=(0,Y.E)(),s=(0,V.T)(),c=ee(n,t.suggestions).activeSuggestion,p=(0,i.useCallback)(function(e){n&&(a.trackSuggestionApplied({interactionId:t.interactionId,suggestionType:t.type,suggestionLabel:e.description,suggestionContent:e.getContentForTracking()}),e.apply(n,s))},[n,a,t,s]);return(0,A.jsx)(v.K,{children:(0,A.jsxs)(o.K,{children:[(0,A.jsx)(d.x,{children:t.message}),t.suggestions.map(function(e){var t=e.themeId,n=e.label,r=e.isOriginal;return(0,A.jsxs)(i.Fragment,{children:[r&&(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(z.i,{borderColor:"blackAlpha.200"}),(0,A.jsxs)(d.x,{children:[n,": "]})]}),(0,A.jsx)(em,{themeId:t,onClick:function(){return p(e.modification)},isSelected:(null==c?void 0:c.themeId)===t})]},t)}),(0,A.jsx)(d.x,{children:(0,A.jsx)(u.cC,{id:"eVMeEi"})}),(0,A.jsx)(l.z,{leftIcon:(0,A.jsx)(E.G,{icon:ed.q2}),w:"100%",onClick:function(){r(),ef.T.emit("toggleThemeBlock",!0)},children:(0,A.jsx)(u.cC,{id:"ni+gIz"})}),(0,A.jsx)(P,{message:t})]})})});eg.displayName="SuggestThemes";var em=(0,i.memo)(function(e){var t=e.themeId,n=e.onClick,r=e.isSelected,o=(0,ep.c2)(t);return"new"===o.id?null:(0,A.jsxs)(L.g,{onClick:n,cursor:"pointer",p:2,borderRadius:"xl",_hover:{bg:"blackAlpha.100"},bg:r?"whiteAlpha.600":void 0,transitionProperty:"common",transitionDuration:"normal",children:[(0,A.jsx)(B.xu,{borderRadius:"lg",overflow:"hidden",w:"100%",children:(0,A.jsx)(el.n,{theme:o,variant:"outline"})}),(0,A.jsxs)(I.U,{alignSelf:"flex-start",color:r?"trueblue.700":void 0,children:[(0,A.jsx)(K.M,{in:r,unmountOnExit:!0,children:(0,A.jsx)(E.G,{icon:U.LE,fixedWidth:!0})}),(0,A.jsx)(d.x,{fontSize:"sm",fontWeight:r?"semibold":void 0,children:o.name})]})]})});em.displayName="ThemeMessageThumbnailPreview";var eh=n(29705),ey=n(84103),ev=(0,i.memo)(function(e){var t=e.message,n=e.sendMessage;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(v.K,{children:t.message&&(0,A.jsx)(A.Fragment,{children:(0,A.jsxs)(d.x,{children:[(0,A.jsx)("span",{className:"emoji",role:"img","aria-label":"sorry",children:"\uD83D\uDE14"})," ",t.message," ",t.learnMoreLink&&(0,A.jsxs)(ey.r,{href:t.learnMoreLink,textDecoration:"underline",isExternal:!0,children:["Learn more ",(0,A.jsx)(eh.h,{mx:"2px",fontSize:"sm"})]})]})})}),(0,A.jsx)(d.x,{color:"gray.500",fontSize:"sm",children:"Here are some other things I can do:"}),(0,A.jsx)(q,{sendMessage:n})]})});ev.displayName="UnsupportedTask";var eb=(0,i.memo)(function(e){var t=e.message;return(0,A.jsx)(v.K,{warning:t.warning,from:t.from,children:t.message})});eb.displayName="UserDesignerMessage";var ex=i.createContext({scrollToBottom:function(){},onClose:function(){}}),ek=function(){return i.useContext(ex)},ew=function(e){var t=e.messages,n=e.scrollSelector,c=e.editor,u=e.sendMessage,d=e.isLoading,l=e.onClose,p=(0,s.q)(),f=p.hasEnoughCreditsToChat,g=p.isCreditsReady&&!f,m=(0,i.useCallback)(function(){var e=n&&document.querySelector(n);e&&setTimeout(function(){requestAnimationFrame(function(){e.scrollTo({top:e.scrollHeight,behavior:"smooth"})})},400)},[n]),h=(0,i.useRef)({scrollToBottom:m,onClose:l});return h.current.scrollToBottom=m,(0,A.jsx)(ex.Provider,{value:h.current,children:(0,A.jsx)(r.k,{flex:1,flexDirection:"column",justifyContent:"flex-end",children:(0,A.jsx)(o.K,{pt:12,spacing:2,children:(0,A.jsxs)(a.M,{children:[(0,A.jsx)(G,{sendMessage:u,hideSuggestions:g}),t.map(function(e){if("text"===e.type)return(0,A.jsx)(eb,{message:e},e.timestamp);if("suggestImages"===e.type)return(0,A.jsx)(es,{message:e,editor:c},e.timestamp);if("generateImage"===e.type)return(0,A.jsx)(D,{message:e,editor:c},e.timestamp);if("suggestText"===e.type)return(0,A.jsx)(ec,{message:e,editor:c},e.timestamp);if("suggestThemes"===e.type)return(0,A.jsx)(eg,{message:e,editor:c},e.timestamp);if("suggestContent"===e.type)return(0,A.jsx)(et,{message:e,editor:c},e.timestamp);if("unsupported"===e.type)return(0,A.jsx)(ev,{message:e,sendMessage:u},e.timestamp);return console.warn("[MessageList] Message type not found",e),null}),g&&(0,A.jsx)(H.x,{}),d&&(0,A.jsx)(eI,{},"loading")]})})})})},eI=function(){return(0,A.jsx)(v.K,{from:"Designer",children:(0,A.jsx)(eC,{})})},eC=function(){return(0,A.jsxs)(r.k,{className:"bouncing-loader",justify:"center",children:[(0,A.jsx)("div",{}),(0,A.jsx)("div",{}),(0,A.jsx)("div",{})]})}},24272:function(e,t,n){n.d(t,{E:function(){return s}});var r=n(2784),o=n(6201),a=n(46358),i=n(15400),s=function(){var e=(0,a.qr)(),t=(0,a.TL)(),n=(0,r.useCallback)(function(e,n){t((0,i.Cj)({taskContext:e,provider:n})),(0,o.hq)({interactionId:e.interactionId,interface:"chat",inputMessage:e.message,docId:e.docId,cardId:e.editorContext.card.cardId,provider:n})},[t]),s=(0,r.useCallback)(function(e){t((0,i.z5)(e))},[t]),c=(0,r.useCallback)(function(e){t((0,i.zw)(e))},[t]),u=(0,r.useCallback)(function(n){t((0,i._M)(n));var r=n.taskContext,a=(0,i.FK)(r.interactionId)(e.getState());if(!a){console.error("[trackRequestComplete] no data found for interactionId",r.interactionId);return}(0,o.gb)({interactionId:r.interactionId,interface:"chat",docId:r.docId,cardId:a.cardId,classification:a.classification,provider:a.provider,inputMessage:r.message,inputContent:a.inputContent,rawResponse:n.resp,outputMessage:a.outputMessage,outputContent:a.outputContent,latency:performance.now()-r.startTime,timeToComplete:performance.now()-r.startTime})},[t,e]),d=(0,r.useCallback)(function(t){var n=t.outputMessage,r=t.errorMessage,a=t.errorCode,s=t.interactionId,c=t.resp,u=t.errorName,d=(0,i.FK)(s)(e.getState());if(!d){console.error("[trackRequestError] no data found for interactionId",s);return}(0,o.pQ)({interactionId:s,interface:"chat",docId:d.docId,cardId:d.cardId,classification:d.classification,provider:d.provider,inputMessage:d.message,inputContent:d.inputContent,outputMessage:n,errorName:u,errorMessage:r,errorCode:a,rawResponse:c,latency:performance.now()-d.startTime})},[e]),l=(0,r.useCallback)(function(t){var n=t.interactionId,r=t.retriesRemaining,a=t.resp,s=(0,i.FK)(n)(e.getState());if(!s){console.error("[trackRequestRetry] no data found for interactionId",n);return}(0,o.Wf)({interactionId:n,interface:"chat",classification:s.classification,docId:s.docId,cardId:s.cardId,provider:s.provider,inputMessage:s.message,inputContent:s.inputContent,rawResponse:a,retriesRemaining:r})},[e]),p=(0,r.useCallback)(function(t){var n=t.interactionId,r=t.suggestionContent,a=t.suggestionType,s=t.suggestionLabel,c=t.autoApplied,u=(0,i.FK)(n)(e.getState());if(!u){console.error("[trackSuggestionApplied] no data found for interactionId",n);return}var d="string"==typeof r?r:"html"===r.type?r.html:"json"===r.type?r.json:void 0;(0,o.vL)({interactionId:n,interface:"chat",docId:u.docId,cardId:u.cardId,classification:u.classification,provider:u.provider,inputMessage:u.message,inputContent:u.inputContent,outputMessage:u.outputMessage,outputContent:u.outputContent,suggestionType:a,suggestionLabel:s,suggestionContent:d,autoApplied:!!c})},[e]);return(0,r.useMemo)(function(){return{trackClassification:s,trackRequestComplete:u,trackInputContent:c,trackRequestSent:n,trackRequestError:d,trackRequestRetry:l,trackSuggestionApplied:p}},[s,c,u,n,d,l,p])}},88299:function(e,t,n){n.d(t,{K:function(){return y}});var r=n(95235),o=n(82269),a=n(11919),i=n(34638),s=n(72360),c=n(48322),u=n(76360),d=n(75342),l=n(98841),p=n(52322),f=["children","from","warning","cardStyleOverrides","error"];function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var h=(0,l.E)(a.k),y=function(e){var t=e.children,n=e.from,r=e.warning,a=void 0!==r&&r,l=e.cardStyleOverrides,g=e.error,y=void 0!==g&&g,v=(0,o.Z)(e,f),b=(0,i.ff)("orchid.400","blue.700"),x=(0,i.ff)("trueblue.50","sunglow.700"),k=(0,i.ff)("red.100","red.500"),w="User"===(void 0===n?"Designer":n),I=w?m({bg:b,borderBottomRightRadius:0,color:"white"},l):m({bg:a?void 0:y?k:x,borderBottomLeftRadius:0},l);return(0,p.jsx)(h,m(m({justify:w?"flex-end":"flex-start",initial:{opacity:0,translateX:-20},animate:{opacity:1,translateX:0}},v),{},{children:a?(0,p.jsxs)(s.b,m(m({status:"warning",borderColor:"orange.200",borderWidth:"1px",fontSize:"inherit"},I),{},{children:[(0,p.jsx)(c.z,{}),t]})):(0,p.jsx)(u.Z,m(m({size:"sm",shadow:"sm",borderRadius:"xl",variant:"filled",minH:0,borderColor:y?"red.200":"blackAlpha.200"},I),{},{children:(0,p.jsx)(d.e,{py:2,px:2,children:t})}))}))}},10676:function(e,t,n){n.d(t,{x:function(){return m}});var r=n(55452),o=n(87254),a=n(11919),i=n(45650),s=n(2784),c=n(68019),u=n(41033),d=n(30118),l=n(46358),p=n(88299),f=n(52322),g=function(){var e=Date.now();return{from:"Designer",type:"text",message:o.ag._({id:"ftZED+"}),timestamp:e}},m=(0,s.memo)(function(e){var t=e.cardStyleOverrides,n=(0,d.M)({id:"ai-credits-modal-in-message"}),o=n.isOpen,m=n.onOpen,h=n.onClose,y=(0,l.CG)(u.Lj),v=(0,s.useMemo)(function(){return g().message},[]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(p.K,{from:"Designer",error:!0,cardStyleOverrides:t,children:[(0,f.jsx)("strong",{children:v})," ",(0,f.jsx)(r.cC,{id:"//XCY6"}),(0,f.jsx)(a.k,{pt:3,children:(0,f.jsx)(i.z,{onClick:m,leftIcon:(0,f.jsx)("span",{role:"img","aria-label":"credits",children:"\uD83D\uDCB0"}),children:(0,f.jsx)(r.cC,{id:"89ftLJ"})})})]}),(0,f.jsx)(c.H,{credits:y,onClose:h,isOpen:o,onOpen:m})]})})},27563:function(e,t,n){n.d(t,{n:function(){return e3}});var r,o,a=n(20406),i=n(28526),s=n.n(i),c=n(12483),u=n(2784),d=n(69862),l=n(16034),p=n(23313),f=n(96412),g=n(13089),m=n(41701),h=n(90129),y=n(29017),v=n(48200),b=n(95235),x=n(29395),k=n(64426),w=n(68941),I=n(39429),C=n(50265),j=[new(function(e){(0,h.Z)(i,e);var t,n,r,o=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,v.Z)(i);if(t){var r=(0,v.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,y.Z)(this,e)});function i(e){var t;return(0,f.Z)(this,i),t=o.call(this,e),(0,b.Z)((0,m.Z)(t),"prompt",void 0),t.prompt=e.prompt,t}return(0,g.Z)(i,[{key:"runPrompt",value:(n=(0,a.Z)(s().mark(function e(t){var n,r,o,a,i,c,u;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.input,r=t.context,o=t.variables,a=t.trackFns,c=void 0===(i=t.retries)?2:i,e.next=3,(0,k.I)(n,r.interactionId,{timeout:w.VH.get("aiRequestTimeouts").basicReply});case 3:if(u=e.sent){e.next=6;break}throw Error("Couldn't get response from prompt");case 6:if(!((0,I.y)(u)||null!=u&&u.includes("```"))){e.next=11;break}if(!(c<=0)){e.next=9;break}throw new d.eo("Did not receive proper response after retries",{chatMessage:"Sorry, I am having trouble understanding. Could you try asking in a different way?",inputMessage:r.message,resp:u,interactionId:r.interactionId});case 9:return a.trackRequestRetry({interactionId:r.interactionId,retriesRemaining:c,resp:u}),e.abrupt("return",this.runPrompt({input:n,context:r,variables:o,trackFns:a,retries:c-1}));case 11:return e.abrupt("return",u);case 12:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"run",value:(r=(0,a.Z)(s().mark(function e(t){var n,r,o,a,i,c,u,d,l;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.context,r=t.addMessage,o=t.history,a=t.trackFns,i=t.provider,c={message:n.message},u=(0,C.x)(o||[]),d=this.prompt.prepare({variables:c,history:u,params:{provider:i},interactionId:n.interactionId}),e.next=6,this.runPrompt({input:d,context:n,variables:c,trackFns:a,retries:1});case 6:l=e.sent,a.trackRequestComplete({taskContext:n,outputMessage:l}),r({from:"Designer",type:"text",message:l,resp:l,interactionId:n.interactionId});case 9:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})}]),i}(x.B))({key:"CHAT",description:"A general chat message, or a request that doesn't fit any of the previous categories",classifyExamples:["hi how are you","hdfoho;safjw","help there are bees everywhere","great job!","this looks ugly"],prompt:new l.V({systemPromptOperation:p.Run.BasicReplyChatSystem,userPromptOperation:p.Run.BasicReplyChatUser,variables:["message"],params:{maxTokens:150,temperature:0}})})],O=function(e){return j.find(function(t){return t.key===e})},R=function(e){return!!j.find(function(t){return t.key===e})},S=n(12741),E=n(28248),T=n(98875),M=n(51331),A=n(6201),P=n(72468),Z=n(69840),D=n(10710);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach(function(t){(0,b.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var F=[new(function(e){(0,h.Z)(o,e);var t,n,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,v.Z)(o);if(t){var r=(0,v.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,y.Z)(this,e)});function o(e){return(0,f.Z)(this,o),r.call(this,e)}return(0,g.Z)(o,[{key:"run",value:(n=(0,a.Z)(s().mark(function e(t){var n,r,o,a,i,c,u,d,l,p;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.addMessage,r=t.context,o=t.trackFns,a=t.history,i=performance.now(),c=Z.S.prepare({variables:{input:r.message,html:r.editorContext.cardContent.html}}),e.next=5,(0,k.I)(c,r.interactionId);case 5:if(u=e.sent){e.next=8;break}throw Error("Couldn't get response from prompt");case 8:return d={prompt:u,count:1},l={interactionId:r.interactionId,interface:"generate-image",provider:"baseten",streaming:!1,inputContent:u,docId:r.docId,generateImageOptions:d},e.prev=10,(0,A.hq)(l),e.next=14,(0,P.Qz)(N({interactionId:r.interactionId,docId:r.docId,workspaceId:(0,D.n_)()},d));case 14:if(0!==(p=e.sent).length){e.next=17;break}throw Error("No images generated");case 17:n({from:"Designer",type:"generateImage",suggestions:p,interactionId:r.interactionId,isFirstGenerationInSession:!a||!a.some(function(e){return"generateImage"===e.type}),message:r.message}),(0,A.o)(N(N({},l),{},{latency:performance.now()-i,generateImageUrls:p.map(function(e){return e.attrs.src})})),o.trackRequestComplete({taskContext:r,outputContent:JSON.stringify(p),outputMessage:""}),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(10),console.error("(caught) [AIGenerateImage] error:",e.t0),(0,A.pQ)(N(N({},l),{},{latency:performance.now()-i,errorName:"GenerateImageError",errorMessage:e.t0.message,outputMessage:""}));case 26:case"end":return e.stop()}},e,null,[[10,22]])})),function(e){return n.apply(this,arguments)})}]),o}(x.B))({key:"GENERATE_IMAGE",description:"Generate an image using AI.",classifyExamples:["generate an image of a panda eating starbursts","add an AI image that shows people talking and working","use AI to make a picture of a laptop on a windowsill","generate an image of a watercolor painting of a flower vase"],classifyReply:"Sure, I'll generate an image of a panda...",checkEnabled:function(){return(0,M.uL)("unlimited_ai")}})],L=function(e){return F.find(function(t){return t.key===e})},q=n(84991),G=n(73593),H=n(9850),U=n.n(H),z=n(74418),B=n(34264),K=n(60636),V=n(43981),W=function(){function e(t){(0,f.Z)(this,e),(0,b.Z)(this,"type","insert-card"),(0,b.Z)(this,"description",void 0),(0,b.Z)(this,"cardId",void 0),(0,b.Z)(this,"afterCardId",void 0),(0,b.Z)(this,"content",void 0),this.description=t.description,this.cardId=t.cardId,this.afterCardId=t.afterCardId,this.content=t.content}return(0,g.Z)(e,[{key:"isApplied",value:function(e){return!!(0,B.Bw)(e,this.cardId)}},{key:"getPreviewJson",value:function(e){var t=e.state.tr;this.transact(e,t);var n=U()(t.doc.toJSON());return(0,V.Y0)(n,this.cardId)}},{key:"apply",value:function(e){if(this.isApplied(e)){console.debug("[InsertCardModification] NOT applying modification, card already exists with cardId=".concat(this.cardId),{modification:this});return}var t=e.state.tr;this.transact(e,t),console.debug("[InsertCardModification] Applying modification",{modification:this}),e.view.dispatch(t),(0,z.YS)({editor:e,cardId:this.cardId})}},{key:"transact",value:function(e,t){var n=(0,B.Bw)(e,this.afterCardId);if(!n)return null;var r=(0,V.Fr)(e,this.content),o=n.pos+n.node.nodeSize;t.insert(o,r.content.firstChild);var a=(0,K.t)(t.doc.resolve(o),1);return t.setSelection(a),{from:o,to:o+t.doc.nodeAt(o).nodeSize}}},{key:"getContentForTracking",value:function(){return this.content}}]),e}(),$=function(){function e(t){(0,f.Z)(this,e),(0,b.Z)(this,"type","remove-card"),(0,b.Z)(this,"description",void 0),(0,b.Z)(this,"cardId",void 0),this.description=t.description,this.cardId=t.cardId}return(0,g.Z)(e,[{key:"isApplied",value:function(e){return!(0,B.Bw)(e,this.cardId)}},{key:"getPreviewJson",value:function(e){return null}},{key:"apply",value:function(e){var t=e.state.tr,n=(0,B.Bw)(e,this.cardId);n&&(t.delete(n.pos,n.pos+n.node.nodeSize),console.debug("[RemoveCardModification] Applying modification",{modification:this}),e.view.dispatch(t))}},{key:"getContentForTracking",value:function(){return this.cardId}}]),e}(),Y=n(68933),J=function(e){(0,h.Z)(o,e);var t,n,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,v.Z)(o);if(t){var r=(0,v.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,f.Z)(this,o),r.apply(this,arguments)}return(0,g.Z)(o,[{key:"getResponseMessages",value:(n=(0,a.Z)(s().mark(function e(t){var n,r,o,a,i,c,u,l,p,f,g,m,h,y,v;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.editor,r=t.context,a=(o=t.response).suggestion,i=o.message,c=o.raw,a){e.next=3;break}throw new d.$D("No card content returned",{interactionId:r.interactionId,resp:c,chatMessage:i||(0,Y.az)(),inputMessage:r.message});case 3:return u=(0,G.hx)((0,G.VA)(n)),l=(0,G.VA)(n).generateInfo,e.next=7,(0,q.sj)(a,{loadImages:!0,docFormatKey:u.key,cardIndex:1,imageOptions:(null==l?void 0:l.imageOptions)||{provider:"web"},theme:r.editorContext.theme,context:{docId:r.docId,workspaceId:(0,D.n_)(),interactionId:r.interactionId}});case 7:return f=(p=e.sent).attrs.id,m={label:"New card",modification:g=new W({description:"New Card",content:{type:"json",json:[p]},cardId:f,afterCardId:r.editorContext.card.cardId}),jsonContentPreview:g.getPreviewJson(n)},y={label:"Remove card",modification:h=new $({description:"Remove card",cardId:f}),jsonContentPreview:h.getPreviewJson(n)},v={from:"Designer",type:"suggestContent",resp:c,message:i||"How about this?",suggestions:[m,y],interactionId:r.interactionId},console.debug("[addCard]",{insert:m,remove:y,message:i,html:a,content:p}),e.abrupt("return",{messages:[v],suggestionToApply:m});case 16:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})}]),o}(Y.w6),Q=new l.V({systemPromptOperation:p.Run.AddCardSystem,userPromptOperation:p.Run.AddCardUser,variables:["html","message","outline"],params:{temperature:.7,maxTokens:1e3}}),X=new J({key:"ADD_CARD",description:"Add a new card after the current one",classifyExamples:["add a new slide","add a card describing our mission","i want a new section for leadership development","make another card","on a new card compare the two options in a table"],classifyReply:"Ok, I'll start writing a new card...",prompt:Q}),ee=n(87254),et=n(46695),en=function(){function e(t){(0,f.Z)(this,e),(0,b.Z)(this,"type","set-card-layout"),(0,b.Z)(this,"description",void 0),(0,b.Z)(this,"cardId",void 0),(0,b.Z)(this,"layout",void 0),this.description=t.description,this.cardId=t.cardId,this.layout=t.layout}return(0,g.Z)(e,[{key:"isApplied",value:function(e){var t=(0,B.Bw)(e,this.cardId);return t?t.node.attrs.layout===this.layout:(console.error("[SetCardLayoutModification.apply] Could not find card to update: ".concat(this.cardId,", maybe deleted")),!1)}},{key:"getPreviewJson",value:function(e){var t=e.state.tr;this.transact(e,t);var n=U()(t.doc.toJSON()),r=(0,V.Y0)(n,this.cardId);return console.debug("[SetCardLayoutModification.getPreviewJson] result",r),r}},{key:"apply",value:function(e){if(this.isApplied(e)){console.debug("[SetCardLayoutModification] NOT applying modification, card already has layout=".concat(this.layout),{modification:this});return}var t=e.state.tr;this.transact(e,t),console.debug("[SetCardLayoutModification] Applying modification",{modification:this}),e.view.dispatch(t),(0,z.YS)({editor:e,cardId:this.cardId})}},{key:"transact",value:function(e,t){var n=(0,B.Bw)(e,this.cardId);if(!n){console.error("[SetCardLayoutModification.apply] Could not find card to update: ".concat(this.cardId,", maybe deleted"));return}(0,et.G)(e,t,n.pos,this.layout)}},{key:"getContentForTracking",value:function(){return this.layout}}]),e}(),er=function(){return ee.ag._({id:"ppX7+s"})},eo=new(function(e){(0,h.Z)(o,e);var t,n,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,v.Z)(o);if(t){var r=(0,v.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,f.Z)(this,o),r.apply(this,arguments)}return(0,g.Z)(o,[{key:"getResponseMessages",value:(n=(0,a.Z)(s().mark(function e(t){var n,r,o,a,i,c,u,l,p,f,g;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.editor,r=t.context,t.rangeId,a=(o=t.response).suggestion,i=o.raw,c=o.message,a){e.next=3;break}throw new d.$D("No card layout returned",{resp:i,chatMessage:er(),inputMessage:r.message,interactionId:r.interactionId});case 3:if((0,B.ol)(a)){e.next=6;break}throw console.error("Invalid card layout:",a),new d.$D("Invalid card layout: ".concat(a),{resp:i,chatMessage:er(),inputMessage:r.message,interactionId:r.interactionId});case 6:return u=new en({description:ee.ag._({id:"nyQWMb"}),cardId:r.editorContext.card.cardId,layout:a}),l={label:ee.ag._({id:"nyQWMb"}),modification:u,jsonContentPreview:u.getPreviewJson(n)},p=new en({description:ee.ag._({id:"HxF6Fk"}),cardId:r.editorContext.card.cardId,layout:r.editorContext.card.attrs.layout}),f={label:ee.ag._({id:"HxF6Fk"}),modification:p,jsonContentPreview:p.getPreviewJson(n)},g={from:"Designer",type:"suggestContent",resp:i,message:c||ee.ag._({id:"pMSbe+"}),interactionId:r.interactionId,suggestions:[l,f]},e.abrupt("return",{messages:[g],suggestionToApply:l});case 12:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})}]),o}(Y.w6))({key:"MOVE_ACCENT_IMAGE",description:"Move or remove the accent image of the card. Use ADD_IMAGE to add accent images.",classifyExamples:["move the sand dune to the left","remove the cover photo"],classifyReply:"Ok, I will move the accent image to the left...",getTaskTarget:function(e){return e.card},prompt:new l.V({systemPromptOperation:p.Run.ChangeAccentImageLayoutSystem,userPromptOperation:p.Run.ChangeAccentImageLayoutUser,variables:["html","message"],params:{temperature:.2,maxTokens:100}}),checkEnabled:function(e){return"blank"!==e.card.attrs.layout}}),ea=new l.V({systemPromptOperation:p.Run.ChangeContentSystem,userPromptOperation:p.Run.ChangeContentUser,variables:["html","message","outline"],params:{temperature:.7,maxTokens:1e3}}),ei=new Y.w6({key:"CHANGE_CONTENT",description:"Rephrase, summarize, expand, change text formatting, add content, or express ideas differently.",classifyExamples:["condense this to just the key points","say this like a pirate","make this more formal","add a box about health benefits","add more text please","make the bullets red","make the text bigger","fill in the last  column","write something about ___","add ___ to the table"],classifyReply:"Ok, I'll try making it shorter...",prompt:ea}),es=n(71949),ec=n(21124),eu=n(67273),ed=n(73805),el=n(81333),ep=new l.V({systemPromptOperation:p.Run.RateImagesSystem,userPromptOperation:p.Run.RateImagesUser,variables:["dataset"],params:{temperature:.1,maxTokens:100}}),ef=(r=(0,a.Z)(s().mark(function e(t,n){var r,o,a;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.map(function(e,t){var n=e.description,r=e.query;return"".concat(t+1,": ").concat(n,": ").concat(r)}).join("\n"),o=ep.prepare({variables:{dataset:r},history:[]}),e.next=4,(0,k.I)(o,n,{timeout:w.VH.get("aiRequestTimeouts").rateImages});case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0="";case 7:return a=e.t0,e.abrupt("return",a.split("\n").map(function(e){var t=e.split("-");return Number((0,el.Z)(t,2)[1].trim())}));case 9:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)});function eg(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function em(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eg(Object(n),!0).forEach(function(t){(0,b.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eg(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eh=new(function(e){(0,h.Z)(i,e);var t,n,r,o=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,v.Z)(i);if(t){var r=(0,v.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,y.Z)(this,e)});function i(){return(0,f.Z)(this,i),o.apply(this,arguments)}return(0,g.Z)(i,[{key:"getResponseData",value:(n=(0,a.Z)(s().mark(function e(t,n){var r,o,i,c;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.replaceAll(this.key,"").split("\n").map(function(){var e=(0,a.Z)(s().mark(function e(t){var n,r;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.split(",").map(function(e){return e.trim()}).slice(0,2),e.next=3,(0,ec.J)({queries:n,count:eu.x.count,provider:"web",prefetch:!0,options:{gammaFeature:"aiChat"}});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:return console.debug("[SuggestImagesTask][getResponseData] allResults",r=e.sent.flat()),console.debug("[SuggestImagesTask][imageRatingData]",{imagesToRate:o=r.map(function(e){var t=e.image,n=e.query,r=(0,ed.C)(t,n,"web");return{description:(0,ed.K)(r)||"",query:n}})}),e.prev=6,e.next=9,ef(o,n);case 9:if(console.debug("[SuggestImagesTask][imageRatingValues]",{imageRatingValues:i=e.sent}),!(i.length!==r.length)){e.next=13;break}throw Error("Image rating values length does not match allResults length");case 13:return console.debug("[SuggestImagesTask][allResultsSorted]",{allResultsSorted:c=r.map(function(e,t){return em(em({},e),{},{rating:i[t]})}).sort(function(e,t){return t.rating-e.rating})}),e.abrupt("return",c);case 19:e.prev=19,e.t0=e.catch(6),console.warn("[SuggestImagesTask] Error rating images. Returing unsorted results.",e.t0);case 22:return e.abrupt("return",r);case 23:case"end":return e.stop()}},e,this,[[6,19]])})),function(e,t){return n.apply(this,arguments)})},{key:"getResponseMessages",value:(r=(0,a.Z)(s().mark(function e(t){var n,r,o,a,i,c;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.context,o=(r=t.response).message,a=r.raw,i=r.suggestion){e.next=3;break}throw new d.$D("No image results were returned",{resp:a,inputMessage:n.message,chatMessage:o||"I'm sorry, I wasn't able to find any images for this.",interactionId:n.interactionId});case 3:return e.next=5,this.getResponseData(i,n.interactionId);case 5:return c={from:"Designer",type:"suggestImages",suggestions:e.sent,resp:a,interactionId:n.interactionId,message:o||"Here are some suggestions:"},e.abrupt("return",{messages:[c]});case 8:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})}]),i}(Y.w6))({key:"ADD_IMAGE",description:"Add images, or replace an existing image. Do not use for moving or removing images.",classifyExamples:["add a picture of a bus","find some different images","this needs a pic","show me dolphins","find a meme of stonks","give me more images","add a background image","i need a graph of population over time"],classifyReply:"Let me look for some good bus pictures...",getTaskTarget:function(e){return e.defaultRange},prompt:new l.V({systemPromptOperation:p.Run.SuggestImagesSystem,userPromptOperation:p.Run.SuggestImagesUser,variables:["html","message"],params:{temperature:.7,maxTokens:500}})}),ey=n(27191),ev=n(24888);function eb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ex(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eb(Object(n),!0).forEach(function(t){(0,b.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eb(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ek(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var ew=new(function(e){(0,h.Z)(o,e);var t,n,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,v.Z)(o);if(t){var r=(0,v.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,f.Z)(this,o),r.apply(this,arguments)}return(0,g.Z)(o,[{key:"getResponseData",value:function(e){var t,n=[],r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ek(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ek(e,t)}}(e))){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}(e.matchAll(/^\/\/\s*(.*)$\n(.*)$/gm));try{for(r.s();!(t=r.n()).done;){var o=t.value,a=o[1],i=o[2];n.push({reason:a,value:i})}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"getResponseMessages",value:(n=(0,a.Z)(s().mark(function e(t){var n,r,o,a,i,c,u,l,p,f,g,m;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.editor,r=t.context,o=t.rangeId,i=(a=t.response).suggestion,c=a.message,u=a.raw,i){e.next=3;break}throw new d.$D("No suggestions found in response",{interactionId:r.interactionId,inputMessage:r.message,chatMessage:c||ee.ag._({id:"7KKeOM"})});case 3:return l=this.getResponseData(i).map(function(e){var t=new ev.O(n,{description:e.reason,content:{type:"html",html:e.value},rangeId:o});return ex(ex({},e),{},{modification:t})}),p=this.determineTaskTarget(r.editorContext).html,f=new ev.O(n,{description:ee.ag._({id:"HxF6Fk"}),content:{type:"html",html:p},rangeId:o}),g={reason:ee.ag._({id:"HxF6Fk"}),value:p,modification:f},m={from:"Designer",type:"suggestText",message:c||ee.ag._({id:"3YHvwF"}),resp:u,suggestions:[].concat((0,S.Z)(l),[g]),interactionId:r.interactionId},e.abrupt("return",{messages:[m]});case 10:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]),o}(Y.w6))({key:"SUGGEST_TEXT",description:"Open-ended request to rephrase a sentence or paragraph",classifyExamples:["write a better headline","How else could i say this?","this feels too corporate","suggest a more engaging way to say this","give me a more interesting description"],classifyReply:"Let me think of some other headlines...",getTaskTarget:function(e){return e.selectionRange},prompt:new l.V({systemPromptOperation:p.Run.SuggestTextSystem,userPromptOperation:p.Run.SuggestTextUser,variables:["html","message"],params:{temperature:.7,maxTokens:1e3}}),checkEnabled:function(e){var t=e.selection,n=t instanceof ey.Bs,r=t.$from.parent.eq(t.$to.parent);return n&&!t.empty&&t.to-t.from<800&&r}}),eI=function(){function e(t,n){(0,f.Z)(this,e),(0,b.Z)(this,"type","change-theme"),(0,b.Z)(this,"description",void 0),(0,b.Z)(this,"themeId",void 0),this.description=n.description,this.themeId=n.themeId}return(0,g.Z)(e,[{key:"apply",value:function(e,t){t.setThemeWithAccentImages(this.themeId)}},{key:"isApplied",value:function(e,t){return t.isThemeApplied(this.themeId)}},{key:"getPreviewJson",value:function(){return null}},{key:"getContentForTracking",value:function(){return this.themeId}}]),e}(),eC=function(e){(0,h.Z)(i,e);var t,n,r,o=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,v.Z)(i);if(t){var r=(0,v.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,y.Z)(this,e)});function i(){return(0,f.Z)(this,i),o.apply(this,arguments)}return(0,g.Z)(i,[{key:"getResponseMessages",value:(n=(0,a.Z)(s().mark(function e(t){var n,r,o,a,i,c,u,l,p,f,g,m,h;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.editor,r=t.context,a=(o=t.response).raw,i=o.suggestion,c=o.message,l=(u=t.themeModificationController).currentThemeId,p=u.isValidTheme,f=null==i?void 0:i.split("\n"),e.next=5,this.getFilteredSuggestions({ids:f,idToRemove:l,editor:n,isValid:p});case 5:if(0!==(g=e.sent).length){e.next=8;break}throw new d.$D("[SuggestContentTask] No themes provided in prompt response",{resp:a,chatMessage:ee.ag._({id:"GNHk+9"}),inputMessage:r.message,interactionId:r.interactionId});case 8:return m={label:ee.ag._({id:"HxF6Fk"}),themeId:l,modification:new eI(n,{description:ee.ag._({id:"HxF6Fk"}),themeId:l}),isOriginal:!0},h={from:"Designer",type:"suggestThemes",resp:a,message:c||ee.ag._({id:"pMSbe+"}),suggestions:[].concat((0,S.Z)(g),[m]),interactionId:r.interactionId},e.abrupt("return",{messages:[h],suggestionToApply:g[0]});case 11:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"getFilteredSuggestions",value:(r=(0,a.Z)(s().mark(function e(t){var n,r,o,a,i;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.ids,r=t.idToRemove,o=t.editor,a=t.isValid,!(!n||0===n.length)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,Promise.all(n.map(function(e){return a(e).then(function(t){return t?e:null})}));case 5:return i=e.sent.filter(function(e){return null!==e}).filter(function(e){return e!==r}).map(function(e){var t=new eI(o,{description:ee.ag._({id:"nyQWMb"}),themeId:e});return{label:ee.ag._({id:"nyQWMb"}),themeId:e,modification:t}}),e.abrupt("return",i);case 8:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)})}]),i}(Y.w6),ej=new l.V({systemPromptOperation:p.Run.SuggestThemeSystem,userPromptOperation:p.Run.SuggestThemeUser,variables:["html","message","outline"],params:{temperature:.7,maxTokens:100,model:"gpt-4-1106-preview"}}),eO=new eC({key:"SUGGEST_THEME",description:"Suggest a theme for the deck. This task will suggest themes based on the deck content or the prompt",classifyExamples:["change the theme","give me a blue theme","change the color palette","make this a dark theme","use a more colorful theme","let's change the look and the feel","change the theme to lilac and periwinkle","i'd like it to look more cheerful and welcoming"],classifyReply:"Let me find some themes...",prompt:ej}),eR=[eo,es.a,ei,ew,eh,X,eO],eS=function(e){return eR.find(function(t){return t.key===e})},eE=function(e){return!!eR.find(function(t){return t.key===e})},eT=function(e){(0,h.Z)(o,e);var t,n,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,v.Z)(o);if(t){var r=(0,v.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,y.Z)(this,e)});function o(e){var t;return(0,f.Z)(this,o),t=r.call(this,e),(0,b.Z)((0,m.Z)(t),"apology",void 0),(0,b.Z)((0,m.Z)(t),"apologyLink",void 0),t.apology=e.apology,t.apologyLink=e.apologyLink,t}return(0,g.Z)(o,[{key:"run",value:(n=(0,a.Z)(s().mark(function e(t){var n,r,o,a;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.classificationResult,r=t.addMessage,o=t.context,a=t.trackFns,r({from:"Designer",type:"unsupported",task:n.classification,message:this.apology,learnMoreLink:this.apologyLink,resp:n.resp,interactionId:o.interactionId}),a.trackRequestComplete({taskContext:o,outputMessage:this.apology});case 3:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})}]),o}(x.B),eM=[new eT({key:"CHANGE_CARD_BACKGROUND",description:"Change the background of the entire section.",classifyExamples:["make the background red","put a tunnel in the background","remove the background","get rid of the image in the background"],apology:"Sorry, I can't change backgrounds yet, but you can click on a card and change the background yourself. You can also change the document background by clicking Page Setup located at the top left corner of the page."}),new eT({key:"CHANGE_FONT",description:"Change the font family or font style.",classifyExamples:["give me a more playful font","make the headings use arial","change the font to be more readable"],apology:"Sorry, I can't change fonts yet. But you can edit them yourself by creating a custom theme.",apologyLink:"https://gamma.app/public/o2he6ual8noal7u#card-82e40n78edir2x8"}),new eT({key:"RESIZE_IMAGE",description:"Change the size of an image (its dimensions), or crop an image",classifyExamples:["make the image smaller","can you make the cat bigger","crop it so it's just the face","I want the disposition of the photos for more portrait instead of landscape"],apology:"Sorry, I can't resize images yet. But you can do it yourself by clicking on the image and dragging the boxes on the corners, or pressing the crop button above the image."}),new eT({key:"EDIT_IMAGE",description:"Edit the appearance of an image",classifyExamples:["make the image brighter","add a blue border to the image","make the image black and white","add a nice filter to the image"],apology:"Sorry, I can't edit images yet."}),new eT({key:"EXPORT",description:"Export or download the deck into a different a format.",classifyExamples:["download as ppt","make a pdf","export to google slides"],apology:"Sorry, I can't export files yet. However, you can download a PDF yourself by using the Share menu."}),new eT({key:"SPLIT_CARD",description:"Split a card into multiple cards, or move content between cards.",classifyExamples:["break this into two cards","split this up as multiple slides","put the gallery on the next card"],apology:"Sorry, I can't split cards or move things between them yet. However, you can split cards yourself by typing /split inside a card."}),new eT({key:"NEW_DECK",description:"Create a whole new deck",classifyExamples:["i need a presentation about [topic]","write a whole document about animal","make me a landing page about this"],apology:"To make a new deck, go back to the home screen and click New with AI."}),new eT({key:"CHANGE_MULTIPLE_CARDS",description:"Make changes across multiple cards at once",classifyExamples:["I want this entire deck to be summarized","combine the cards together in one","make the whole doc sound more professional","make the deck more consistent","translate all of the cards","change the font for the whole deck"],apology:"Sorry, I can only change one card at a time right now."}),new eT({key:"CHANGE_ANOTHER_CARDS",description:"Make changes for an unselected card",classifyExamples:["make the same change for the next card","do the same thing for the other cards","change the last card too","make this layout match the layout of the previous card","copy the first section from the last card here"],apology:"Sorry, I can only look at one card at a time right now. You can have me edit other cards by clicking on them."}),new eT({key:"ADD_VIDEO",description:"Add a video or replace an existing video",classifyExamples:["add a youtube video about scrum","find videos of cats","i need more videos"],apology:"Sorry, I can't search for videos yet. You can embed video by copying the URL and pasting it into the card directly."}),new eT({key:"ADD_FOOTNOTE",description:"Add a footnote to a card, or change footnotes",classifyExamples:["add a biography for him in a footnote","put the details into footnotes"],apology:"Sorry, I haven't learned to add footnotes yet. You can make footnotes by highlighting text and clicking the footnote button in the menu."}),new eT({key:"MOVE_CARD",description:"Move a card to a different position in the deck",classifyExamples:["shift the slide to the top","move this card to the bottom"],apology:"Sorry, I haven't learned to move cards yet. You can move them by hovering on the table of contents on the left side of the screen and dragging them around."}),new eT({key:"ADD_CHART",description:"Add a chart, diagram, or graph",classifyExamples:["put this information into a scatter plot","add a card about market share using a pie chart","i need to display this as a flow chart","create a diagram illustrating the interactions and relationships","can you change the card to have a line graph","turn this into a gantt chart","could you do this as a funnel diagram"],apology:"Sorry, Gamma doesn't support charts yet. You can paste in images of charts from other tools, or type /diagram in the editor to draw your own."}),new eT({key:"ANIMATION",description:"Add animations to a card or edit animations",classifyExamples:["animate transitions","make the text appear one by one","fade in the images","make the bullets fly in"],apology:'Sorry, Gamma doesn\'t support custom animations yet. You can animate line by line by going into Present mode and pressing S for "spotlight".'}),new eT({key:"FOLLOW_LINK",description:"Read content from an external website",classifyExamples:["go to this website and add the content to this card http://www.example.com/","here is his linkedin page now add the details https://www.linkedin.com/...","add the images from https://medium.com/posts/2022/9/6/..."],apology:"Sorry, I'm not able to open links and read the content."}),new eT({key:"SHADOW",description:"Add or edit shadow for an element or text",classifyExamples:["add a drop shadow to the image","make the text have a shadow","make the button have a darker shadow"],apology:"Sorry, I'm not able to add custom shadows yet."})],eA=function(e){return eM.find(function(t){return t.key===e})},eP=new l.V({variables:["message","taskList","ackExamples","html","cardHtml"],systemPromptOperation:p.Run.ClassifySystem,userPromptOperation:p.Run.ClassifyUser,params:{maxTokens:100,temperature:.2}}),eZ=[].concat((0,S.Z)(eR),(0,S.Z)(eM),(0,S.Z)(j),(0,S.Z)(F)),eD="\uD83D\uDE14 Sorry, I didn't understand your request. Could you please try asking a different way?",e_=(o=(0,a.Z)(s().mark(function e(t){var n,r,o,a,i,c,u,d,l,p,f,g,m;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.message,r=t.context,o=t.history,a=t.provider,c=(i=eL(eZ,r.editorContext)).ackExamples,u=i.taskList,d=i.enabledTasks,l=eq(o),p=eP.prepare({variables:{message:n,ackExamples:c,taskList:u,html:r.editorContext.defaultRange.html,cardHtml:r.editorContext.card.html},params:{provider:a},history:l}),console.debug("[AIChat classify] Getting classification",{classifyHistory:l,input:p}),e.next=7,(0,E.oO)(p);case 7:return f=e.sent,e.next=10,(0,k.I)(f,r.interactionId,{timeout:T.VH.get("aiRequestTimeouts").classify});case 10:if(m=eF(g=e.sent,d)){e.next=18;break}return console.debug("Failed classification, trying again...",{resp:g,parsedResp:m}),e.next=16,(0,k.I)(p,r.interactionId);case 16:m=eF(g=e.sent,d);case 18:if(m){e.next=20;break}return e.abrupt("return",{type:"UNKNOWN",classification:"UNKNOWN",ack:eD,resp:g||""});case 20:return console.debug("[AIChat classify] Got classification",{resp:g,parsedResp:m}),e.abrupt("return",m);case 22:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)}),eN="Ok, I'll get right on it.",eF=function(e,t){if(e){var n,r=e.split("\n"),o=null===(n=r[0])||void 0===n?void 0:n.trim().toUpperCase();if(t.find(function(e){return e.key===o})){var a=r[1];return{classification:o.trim(),ack:a.includes(o.trim())?eN:a||("UNKNOWN"!==o?eN:eD),resp:e,type:"CLASSIFICATION"}}}},eL=function(e,t){var n=e.filter(function(e){return!t||!e.checkEnabled||e.checkEnabled(t)});return{taskList:n.map(function(e){var t;return"".concat(e.key,": ").concat(e.description,"\n").concat(null===(t=e.classifyExamples)||void 0===t?void 0:t.map(function(e){return"- ".concat(e)}).join("\n"))}).join("\n\n"),ackExamples:n.filter(function(e){return e.classifyExamples&&e.classifyExamples.length>0&&e.classifyReply}).map(function(e){return"Request:\n".concat(e.classifyExamples[0],"\nResponse:\n").concat([e.key,e.classifyReply].join("\n"))}).join("\n\n"),enabledTasks:n}},eq=function(e){return e.slice(-7).map(function(e){return"User"===e.from?{role:p.XaP.User,content:e.message}:e.isClassification?{role:p.XaP.Assistant,content:e.resp}:null}).filter(function(e){return!!e})},eG=n(97782),eH=n(70099),eU=n(95498),ez=n(54113),eB=n(46358),eK=n(12172),eV=n(65185),eW=n(62141),e$=n(95472),eY=n(39428),eJ=n(17033),eQ=function(e,t){var n=e.state.doc.slice(t.from,t.to).content;return(0,eK.c)(e,n)},eX=function(e,t){var n=e.state.selection,r=(0,e$.Ru)(n.$from,B.KH)[0],o=r&&(0,eJ.NE)(r.node,r.pos);if(!r||!o)throw Error("Cant find parent card for selection ".concat(n));var a={from:r.pos,to:r.pos+r.node.nodeSize},i={from:o.pos+1,to:o.pos+o.node.nodeSize-1},s=n.$from.blockRange(n.$to),c={from:s.start,to:s.end},u={range:(0,eY.bb)(e.state,i),html:eQ(e,i)},d={range:(0,eY.bb)(e.state,n),html:eQ(e,n)},l={range:(0,eY.bb)(e.state,c),html:eQ(e,c)},p=n instanceof ey.qv&&(0,B.KH)(n.node)||n.empty||0===d.html.trim().length||n instanceof ey.qv&&n.node.isAtom,f=!n.$from.parent.eq(n.$to.parent)||0===s.$from.parentOffset&&s.$to.parentOffset===s.$to.parent.content.size,g=d,m="selectionRange";p?(g=u,m="cardContent"):f&&(g=l,m="blockRange");var h=e0(t),y=(0,eW.Pu)(t.getState());return{card:{cardId:r.node.attrs.id,range:(0,eY.bb)(e.state,a),html:eQ(e,a),attrs:r.node.attrs},cardContent:u,blockRange:l,selectionRange:d,defaultRange:g,selection:n,outline:h,selectedDefaultRange:m,theme:y}},e0=function(e){var t=e.getState(),n=(0,eW.X9)(t),r=(0,eV.mT)(t);return Object.keys(n.tree).map(function(e){var t;return null===(t=r.find(function(t){return t.id===e}))||void 0===t?void 0:t.title}).filter(function(e){return!!e}).join("\n")},e1=n(24272),e2=n(70548),e3=function(e){var t,n=e.editor,r=e.addMessage,o=e.getMessageHistory,i=(0,eB.qr)(),l=(0,e1.E)(),p=(0,eU.q)().hasEnoughCreditsToChat,f=(0,eG.T)(),g=(0,eH.g5)(),m=(0,eB.TL)(),h=(0,eB.CG)(e2.mW),y=(0,u.useCallback)(function(e){m((0,e2.Tf)(e))},[m]);return{sendMessage:(0,u.useCallback)((t=(0,a.Z)(s().mark(function e(t){var a,u,m,h,v,b,x,k,w,I,C,j,S,T;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.message,n){e.next=3;break}return e.abrupt("return");case 3:if(u=void 0,m=void 0,h=void 0,v=(0,A.nZ)(),e.prev=7,u=eX(n,i),console.debug("[AIChat] starting interaction",m={interactionId:v,startTime:performance.now(),message:a,editorContext:u,docId:n.gammaDocId}),b=o(),r({from:"User",type:"text",message:a,interactionId:v}),l.trackRequestSent(m,g),p){e.next=16;break}return e.abrupt("return");case 16:return y("classifying"),e.next=19,e_({message:a,context:m,history:b,provider:g});case 19:if(x=e.sent,l.trackClassification({taskContext:m,classification:x.classification}),y("fetching"),console.debug("[AIChat] Starting task",{taskContext:m,classification:x.classification,history:b}),"UNKNOWN"!==x.type){e.next=28;break}r({from:"Designer",type:"text",message:x.ack,resp:x.resp,isClassification:!0,interactionId:v}),l.trackRequestComplete({taskContext:m,outputMessage:x.ack}),e.next=55;break;case 28:if(!R(x.classification)){e.next=34;break}return k=O(x.classification),e.next=32,k.run({editor:n,addMessage:r,context:m,classificationResult:x,history:b,trackFns:l,themeModificationController:f,provider:g});case 32:case 38:e.next=55;break;case 34:if(!eA(x.classification)){e.next=40;break}return w=eA(x.classification),e.next=38,w.run({editor:n,context:m,addMessage:r,classificationResult:x,history:b,trackFns:l,themeModificationController:f,provider:g});case 40:if(!eE(x.classification)){e.next=49;break}return r({from:"Designer",type:"text",message:x.ack||"Sure, let me see what I can do...",resp:x.resp,isClassification:!0}),I=o(),C=eS(x.classification),e.next=46,C.run({editor:n,context:m,addMessage:r,classificationResult:x,history:I,trackFns:l,themeModificationController:f,provider:g});case 46:h="chatSuggestion",e.next=55;break;case 49:if(!L(x.classification)){e.next=55;break}return r({from:"Designer",type:"text",message:x.ack||"Sure, let me see what I can do...",resp:x.resp,isClassification:!0}),j=L(x.classification),e.next=54,j.run({editor:n,context:m,addMessage:r,classificationResult:x,history:b,trackFns:l,themeModificationController:f,provider:g});case 54:h="generateImage";case 55:e.next=62;break;case 57:e.prev=57,e.t0=e.catch(7),console.log("[AIChat.sendMessage] ERROR: ".concat(e.t0.message,"}"),{err:e.t0,taskContext:m}),S="Sorry, something unexpected happened. Please try again.",e.t0 instanceof d.Og?(r({from:"Designer",type:"text",message:T=e.t0.opts.chatMessage||S,resp:e.t0.opts.resp,interactionId:v}),l.trackRequestError({errorName:e.t0.name,interactionId:v,outputMessage:T,errorMessage:e.t0.message,resp:e.t0.opts.resp})):(c.Tb(e.t0),r({from:"Designer",type:"text",message:S,interactionId:v}),l.trackRequestError({errorName:e.t0.name,interactionId:v,outputMessage:S,errorMessage:e.t0.message,errorCode:(0,E.uc)(e.t0)[0]}));case 62:h&&(0,ez.d)(h),y("idle");case 64:case"end":return e.stop()}},e,null,[[7,57]])})),function(e){return t.apply(this,arguments)}),[n,i,o,r,l,p,f,g,y]),status:h}}},6985:function(e,t,n){n.d(t,{T:function(){return r}});var r=new(n(98555)).v},74542:function(e,t,n){function r(e){return e}function o(e){return Math.sin(e*Math.PI/2)}function a(e){return 1-Math.pow(1-e,3)}function i(e){return Math.sqrt(1-Math.pow(e-1,2))}function s(e){return 1-(1-e)*(1-e)}function c(e){return 1-Math.pow(1-e,4)}function u(e){return 1===e?1:1-Math.pow(2,-10*e)}function d(e,t,n){return e*(1-n)+t*n}n.d(t,{Y3:function(){return c},ad:function(){return u},ei:function(){return i},gA:function(){return r},hl:function(){return s},t7:function(){return d},vh:function(){return o},w2:function(){return a}})}}]);
//# sourceMappingURL=3162-280307e83a7a903e.js.map